<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一个信息安全从业者的博客"><meta name="keywords" content="信息安全, 网络安全, 黑客, 渗透测试, Linux安全运维, 安全开发, python"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>驭龙hids入侵检测功能初探 | pirogue</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">驭龙hids入侵检测功能初探</h1><a id="logo" href="/.">pirogue</a><p class="description">你曾听过一个地方，到达之时我们将拥有一切吗？</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">驭龙hids入侵检测功能初探</h1><div class="post-meta"><a href="/2018/04/20/yulong-hids/#comments" class="comment-count"></a><p><span class="date">Apr 20, 2018</span><span><a href="/categories/安全建设/" class="category">安全建设</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="一、进程实时监控"><a href="#一、进程实时监控" class="headerlink" title="一、进程实时监控"></a>一、进程实时监控</h2><p>通过hook技术在windows和Linux操作系统的ring0级别进行监控进程和命令执行。</p>
<p>Windows：</p>
<p>NT式驱动服务开机自启动：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services</p>
<p>net start pro</p>
<h2 id="二、网络链接实时监控"><a href="#二、网络链接实时监控" class="headerlink" title="二、网络链接实时监控"></a>二、网络链接实时监控</h2><p>通过pcap(gopcap)进行对网络链接进行实时抓包。</p>
<p>Windows：装WinPcap</p>
<p>Linux：装libpcap</p>
<h2 id="三、文件操作实时监控"><a href="#三、文件操作实时监控" class="headerlink" title="三、文件操作实时监控"></a>三、文件操作实时监控</h2><p>通过inotify（fsnotify）监控磁盘文件变化。</p>
<h2 id="四、ES索引类型字段"><a href="#四、ES索引类型字段" class="headerlink" title="四、ES索引类型字段"></a>四、ES索引类型字段</h2><p>索引：monitor2018_04</p>
<p>类型：connection、file、loginlog、process</p>
<p>字段：data.action、data.command、data.dir、data.hash、data.hostname、data.info、data.local、data.name、data.parentname、data.path、data.pid、data.ppid、data.protocol、data.remote、data.status、data.user、data.username、ip、time</p>
<p>举例：</p>
<table>
<thead>
<tr>
<th>_index</th>
<th style="text-align:center">_type</th>
<th style="text-align:center">_id</th>
<th style="text-align:center">_score</th>
<th style="text-align:center">ip</th>
<th style="text-align:center">data.remote</th>
<th style="text-align:center">data.status</th>
<th style="text-align:center">data.username</th>
<th style="text-align:center">time</th>
<th style="text-align:center">data.dir</th>
<th style="text-align:center">data.local</th>
<th style="text-align:center">data.name</th>
<th style="text-align:center">data.pid</th>
<th style="text-align:center">data.protocol</th>
<th style="text-align:center">data.action</th>
<th style="text-align:center">data.hash</th>
<th style="text-align:center">data.path</th>
<th style="text-align:center">data.user</th>
<th style="text-align:center">data.command</th>
<th style="text-align:center">data.info</th>
<th style="text-align:center">data.parentname</th>
<th style="text-align:right">data.ppid</th>
</tr>
</thead>
<tbody>
<tr>
<td>monitor2018_04</td>
<td style="text-align:center">loginlog</td>
<td style="text-align:center">AWKodaW5ZT0_Kn0N9YOy</td>
<td style="text-align:center">1</td>
<td style="text-align:center">192.168.1.1</td>
<td style="text-align:center">0</td>
<td style="text-align:center">true</td>
<td style="text-align:center">Administrator</td>
<td style="text-align:center">2018-02-17T18:37:44+07:00</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td>monitor2018_04</td>
<td style="text-align:center">connection</td>
<td style="text-align:center">AWKpDlutZT0_Kn0N9Ydd</td>
<td style="text-align:center">1</td>
<td style="text-align:center">192.168.1.1</td>
<td style="text-align:center">182.118.40.31</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">2018-04-09T14:18:06+08:00</td>
<td style="text-align:center">out</td>
<td style="text-align:center">192.168.1.1:54080</td>
<td style="text-align:center">LiveUpdate360.exe</td>
<td style="text-align:center">3524</td>
<td style="text-align:center">tcp</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td>monitor2018_04</td>
<td style="text-align:center">file</td>
<td style="text-align:center">AWKo3gdkZT0_Kn0N9Ycu</td>
<td style="text-align:center">1</td>
<td style="text-align:center">192.168.1.1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">2018-04-09T13:25:21+08:00</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">WRITE</td>
<td style="text-align:center">899a5bf1669610cdb78d322ac8d9358b</td>
<td style="text-align:center">c:\windows\sysnative\Packet.dll</td>
<td style="text-align:center">Administrators</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:right"></td>
</tr>
<tr>
<td>monitor2018_04</td>
<td style="text-align:center">process</td>
<td style="text-align:center">AWKzeH6oZT0_Kn0N9Y0x</td>
<td style="text-align:center">1</td>
<td style="text-align:center">192.168.1.1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">2018-04-11T14:49:43+08:00</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">cmd.exe</td>
<td style="text-align:center">2380</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">sqlservr.exe</td>
<td style="text-align:right">1392</td>
</tr>
</tbody>
</table>
<h2 id="五、MongoDB数据库"><a href="#五、MongoDB数据库" class="headerlink" title="五、MongoDB数据库"></a>五、MongoDB数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;show collections</span><br><span class="line">client</span><br><span class="line">config</span><br><span class="line">file</span><br><span class="line">info</span><br><span class="line">notice</span><br><span class="line">rules</span><br><span class="line">server</span><br><span class="line">statistics</span><br></pre></td></tr></table></figure>
<p>字段数据举例：</p>
<p><strong> client：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.client.find()</span><br><span class="line"></span><br><span class="line"> &quot;_id&quot; : ObjectId(&quot;5acf4cde5e2ba50ef19a6347&quot;), &quot;ip&quot; : &quot;192.168.1.2&quot;, &quot;hostname&quot; : &quot;bbbbbbbbbbbbbbb&quot;, &quot;path&quot; : [ ], &quot;system&quot; : &quot;Windows Server 2008 R2 Enterprise  64&quot;, &quot;type&quot; : &quot;db&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-12T12:15:10.475Z&quot;), &quot;health&quot; : 1 &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acf4dec5e2ba50ef1b547f9&quot;), &quot;ip&quot; : &quot;192.168.1.3&quot;, &quot;hostname&quot; : &quot;bbbbbbbbbbbbbbb&quot;, &quot;path&quot; : [ ], &quot;system&quot; : &quot;Windows Server 2008 R2 Enterprise  64&quot;, &quot;type&quot; : &quot;db&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-13T10:29:36.636Z&quot;), &quot;health&quot; : 2 &#125;</span><br><span class="line"></span><br><span class="line">0健康 1离线 2存在防火墙阻拦</span><br></pre></td></tr></table></figure>
<p><strong> config：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.config.find()</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e2&quot;), &quot;type&quot; : &quot;client&quot;, &quot;dic&quot; : &#123; &quot;cycle&quot; : 2, &quot;udp&quot; : false, &quot;lan&quot; : false, &quot;monitorPath&quot; : [ &quot;%windows%&quot;, &quot;%system32%&quot;, &quot;%web%&quot;, &quot;/etc/&quot;, &quot;/bin/&quot;, &quot;/sbin/&quot;, &quot;/usr/bin/&quot;, &quot;/usr/sbin/&quot; ] &#125; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e3&quot;), &quot;type&quot; : &quot;server&quot;, &quot;dic&quot; : &#123; &quot;publickey&quot; : &quot;-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDJcyrbTRmezc++tR1ZF4R0LktE\nNye/MHY07CE229av69YnJuUtYnEWc1471mDhaJmL8kAb+46Bt7y7L53H2t4VuMTd\nQfghZ/QAyKWsumupZhll0clh3bbROKHfJbNYSydmT+M9GbLygGeH1zLpSL8Qx9to\n4eVPhcIUMhjGGxbpqwIDAQAB\n-----END PUBLIC KEY-----\n&quot;, &quot;privatekey&quot; : &quot;-----BEGIN RSA PRIVATE KEY-----\nMIICXgIBAAKBgQDJcyrbTRmezc++tR1ZF4R0LktENye/MHY07CE229av69YnJuUt\nYnEWc1471mDhaJmL8kAb+46Bt7y7L53H2t4VuMTdQfghZ/QAyKWsumupZhll0clh\n3bbROKHfJbNYSydmT+M9GbLygGeH1zLpSL8Qx9to4eVPhcIUMhjGGxbpqwIDAQAB\nAoGBAImFMFWDHaFWOKKku0MtlcNGMyV/TYfsClX4eHgdvUJdCdWybLL9x9ueqE7K\n+1oFcQSjPHad1Nvi1VknmVtsozwTAMWoRq1J1NLVK4nxKpB4G1WRw7lQPLTLwmkZ\n3MuvNHQpFKtUGgAnv8bOer2ijDpkg72FCU140ETapTGHVmfBAkEA/TMb8vgwhYK8\nnu/telcL8BStGbp+pS0T84Zcg4kdlznsQHXPnpueSQvsJmXeSW9zaDf/cQUMJFvT\nHzfbNgLSIQJBAMutiak/F6A1caFuS3uiDLwBnFBjvWR16YKonhSomSbE2RP4xPMm\nXXhjv1xPtLfav1Rx95txjiZyREjJNzlsGksCQQDZOhoGcAwg3zM4IJvbVAb36KVB\n55Bz4aK2UVXZu69ZaOZZvzlq2BQKk2H853S4CBg5F6Hdsvjh0K3moKM/SVhBAkBo\nOjDk9A1iBZdVdbyY0s9TcjuMg83KV/Cb1S+4AKMGzNsNNlOK3goc7mZhlcQ0BXO9\ngeikmhKVKAo7eQSSlPhLAkEApEHlFSWjbedA9RgHuUa/BeX6htRoghfOfS34Ebqg\ntuxp35YdsLs6iDl7zf1ZQuUvUsTPhXnSzP2Yti0/dI7Ejg==\n-----END RSA PRIVATE KEY-----\n&quot;, &quot;cert&quot; : &quot;-----BEGIN CERTIFICATE-----\nMIICEDCCAXmgAwIBAgIJANcVcODaSbzPMA0GCSqGSIb3DQEBBQUAMCExHzAdBgNV\nBAMMFmRvbWFpbi1zZWMtcHJvamVjdC5jb20wHhcNMTgwNDA4MDkzNjM3WhcNMjgw\nNDA1MDkzNjM3WjAhMR8wHQYDVQQDDBZkb21haW4tc2VjLXByb2plY3QuY29tMIGf\nMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDJcyrbTRmezc++tR1ZF4R0LktENye/\nMHY07CE229av69YnJuUtYnEWc1471mDhaJmL8kAb+46Bt7y7L53H2t4VuMTdQfgh\nZ/QAyKWsumupZhll0clh3bbROKHfJbNYSydmT+M9GbLygGeH1zLpSL8Qx9to4eVP\nhcIUMhjGGxbpqwIDAQABo1AwTjAdBgNVHQ4EFgQUZwP3xxBKYkhKUFyxt4ZoktDU\ne0YwHwYDVR0jBBgwFoAUZwP3xxBKYkhKUFyxt4ZoktDUe0YwDAYDVR0TBAUwAwEB\n/zANBgkqhkiG9w0BAQUFAAOBgQATrutSnvbPTqrPv+19DQZSSSTWQoyaddPT3Q5i\nvyqerVrozRfgHbxKspZZIyJL04BQtCLj+85yIIRfgTbWozy5pwimjJYd8NB72PUr\n8mirgWqewMLe1mhWmS8IXOJfzFhB9azlj5sly47JunLnbKlaVqU+ZtjUiq7jKw4p\nlpBftw==\n-----END CERTIFICATE-----\n&quot;, &quot;learn&quot; : false, &quot;offlinecheck&quot; : false &#125; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e4&quot;), &quot;type&quot; : &quot;intelligence&quot;, &quot;dic&quot; : &#123; &quot;switch&quot; : false, &quot;ipapi&quot; : &quot;http://127.0.0.1/api/?ip=&#123;$ip&#125;&quot;, &quot;fileapi&quot; : &quot;http://127.0.0.1/api/?hash=&#123;$hash&#125;&quot;, &quot;regex&quot; : &quot;black&quot; &#125; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e5&quot;), &quot;dic&quot; : &#123; &quot;switch&quot; : false, &quot;onlyhigh&quot; : false, &quot;api&quot;: &quot;http://127.0.0.1/test/?text=&#123;$info&#125;&quot; &#125;, &quot;type&quot; : &quot;notice&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e6&quot;), &quot;dic&quot; : &#123; &quot;file&quot; : [ ], &quot;ip&quot; : [ ], &quot;process&quot; : [ ], &quot;other&quot; : [ ] &#125;, &quot;type&quot; : &quot;whitelist&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e7&quot;), &quot;type&quot; : &quot;blacklist&quot;, &quot;dic&quot; : &#123; &quot;process&quot; : [ &quot;mssecsvc\\.exe&quot;, &quot;tasksche\\.exe&quot; ], &quot;other&quot; : [ ], &quot;file&quot; : [ ], &quot;ip&quot; : [ ] &#125; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e8&quot;), &quot;type&quot; : &quot;filter&quot;, &quot;dic&quot; : &#123; &quot;file&quot; : [ &quot;^c:\\\\windows\\\\temp$&quot;, &quot;\\.(png|js|css|jpg|gif|wolff|svg)$&quot; ], &quot;ip&quot; : [ ], &quot;process&quot; : [ &quot;c:\\\\windows\\\\system32\\\\wbem\\\\wmiprvse.exe&quot; ] &#125; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e1a25e2ba50ef1a758e9&quot;), &quot;type&quot; : &quot;web&quot;, &quot;dic&quot; : &#123; &quot;tfakey&quot; : &quot;&quot; &#125; &#125;</span><br></pre></td></tr></table></figure>
<p><strong> file: </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.file.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e22c5e2ba50ef1a7591f&quot;), &quot;platform&quot; : &quot;64&quot;, &quot;system&quot; : &quot;linux&quot;, &quot;type&quot; : &quot;agent&quot;, &quot;hash&quot; : &quot;08e2a1144e4191e375cb03fcd5e7a7c3&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:36.178Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e22c5e2ba50ef1a75922&quot;), &quot;platform&quot; : &quot;64&quot;, &quot;system&quot; : &quot;linux&quot;, &quot;type&quot; : &quot;daemon&quot;, &quot;hash&quot; : &quot;5b1ddf0f8ee2fc9c170be29462cdcc54&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:36.218Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e22c5e2ba50ef1a75925&quot;), &quot;platform&quot; : &quot;64&quot;, &quot;system&quot; : &quot;linux&quot;, &quot;type&quot; : &quot;data&quot;, &quot;hash&quot; : &quot;ec777b4a79f32254f5a8dae10cf029b2&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:36.222Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e2305e2ba50ef1a7592c&quot;), &quot;platform&quot; : &quot;32&quot;, &quot;system&quot; : &quot;windows&quot;, &quot;type&quot; : &quot;agent&quot;, &quot;hash&quot; : &quot;536f05fd939ae563fbdd7e52a3d7e132&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:40.776Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e2305e2ba50ef1a7592f&quot;), &quot;platform&quot; : &quot;32&quot;, &quot;system&quot; : &quot;windows&quot;, &quot;type&quot; : &quot;daemon&quot;, &quot;hash&quot; : &quot;37e3593a084dff5e2bce85dd4815cf8e&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:40.792Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e2305e2ba50ef1a75932&quot;), &quot;platform&quot; : &quot;32&quot;, &quot;system&quot; : &quot;windows&quot;, &quot;type&quot; : &quot;data&quot;, &quot;hash&quot; : &quot;ce04138b9f0336f5c30297d34b44b63a&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:40.793Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e2305e2ba50ef1a75938&quot;), &quot;platform&quot; : &quot;64&quot;, &quot;system&quot; : &quot;windows&quot;, &quot;type&quot; : &quot;agent&quot;, &quot;hash&quot; : &quot;536f05fd939ae563fbdd7e52a3d7e132&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:40.935Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e2305e2ba50ef1a7593b&quot;), &quot;platform&quot; : &quot;64&quot;, &quot;system&quot; : &quot;windows&quot;, &quot;type&quot; : &quot;daemon&quot;, &quot;hash&quot; : &quot;37e3593a084dff5e2bce85dd4815cf8e&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:40.951Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5ac9e2305e2ba50ef1a7593e&quot;), &quot;platform&quot; : &quot;64&quot;, &quot;system&quot; : &quot;windows&quot;, &quot;type&quot; : &quot;data&quot;, &quot;hash&quot; : &quot;00af5f5a51df34a942d44cf9641ad368&quot;, &quot;uptime&quot; : ISODate(&quot;2018-04-08T09:34:40.953Z&quot;) &#125;</span><br></pre></td></tr></table></figure>
<p><strong> info: </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.info.findOne()</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5aca09915e2ba50ef1ac00a7&quot;),</span><br><span class="line">&quot;ip&quot; : &quot;192.168.1.4&quot;,</span><br><span class="line">&quot;type&quot; : &quot;userlist&quot;,</span><br><span class="line">&quot;system&quot; : &quot;linux&quot;,</span><br><span class="line">&quot;data&quot; : [</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot; : &quot;root&quot;,</span><br><span class="line">&quot;description&quot; : &quot;x:0:0:root:/root:/bin/bash&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;description&quot; : &quot;x:5:0:sync:/sbin:/bin/sync&quot;,</span><br><span class="line">&quot;name&quot; : &quot;sync&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot; : &quot;shutdown&quot;,</span><br><span class="line">&quot;description&quot; : &quot;x:6:0:shutdown:/sbin:/sbin/shutdown&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;description&quot; : &quot;x:7:0:halt:/sbin:/sbin/halt&quot;,</span><br><span class="line">&quot;name&quot; : &quot;halt&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;description&quot; : &quot;x:500:500::/home/niubi:/bin/bash&quot;,</span><br><span class="line">&quot;name&quot; : &quot;niubi&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot; : &quot;papapa&quot;,</span><br><span class="line">&quot;description&quot; : &quot;x:550:550::/home/papapa:/bin/bash&quot;</span><br><span class="line">&#125;</span><br><span class="line">],</span><br><span class="line">&quot;uptime&quot; : ISODate(&quot;2018-04-09T09:05:48.640Z&quot;)</span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p><strong> notice：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; db.notice.findOne()</span><br><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5aca09915e2ba50ef1ac00ee&quot;),</span><br><span class="line">&quot;description&quot; : &quot;企业网络中首次出现的linux可登陆用户&quot;,</span><br><span class="line">&quot;info&quot; : &quot;root|x:0:0:root:/root:/bin/bash&quot;,</span><br><span class="line">&quot;ip&quot; : &quot;192.168.1.4&quot;,</span><br><span class="line">&quot;level&quot; : 1,</span><br><span class="line">&quot;source&quot; : &quot;可疑用户&quot;,</span><br><span class="line">&quot;status&quot; : 4,</span><br><span class="line">&quot;time&quot; : ISODate(&quot;2018-04-08T12:22:41.864Z&quot;),</span><br><span class="line">&quot;type&quot; : &quot;userlist&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> rules：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5ac9e1de5e2ba50ef1a758f8&quot;),</span><br><span class="line">&quot;enabled&quot; : true,</span><br><span class="line">&quot;meta&quot; : &#123;</span><br><span class="line">&quot;description&quot; : &quot;web进程执行了系统命令，可能为命令执行漏洞或者webshell行为&quot;,</span><br><span class="line">&quot;level&quot; : 0,</span><br><span class="line">&quot;name&quot; : &quot;WebServer可疑进程启动(windows)&quot;,</span><br><span class="line">&quot;author&quot; : &quot;wolf&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;rules&quot; : &#123;</span><br><span class="line">&quot;name&quot; : &#123;</span><br><span class="line">&quot;data&quot; : &quot;^(cmd\\.exe|powershell\\.exe)$&quot;,</span><br><span class="line">&quot;type&quot; : &quot;regex&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;parentname&quot; : &#123;</span><br><span class="line">&quot;data&quot; : &quot;^(w3wp\\.exe|httpd\\.exe|nginx\\.exe|php-cgi\\.exe)$&quot;,</span><br><span class="line">&quot;type&quot; : &quot;regex&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;source&quot; : &quot;process&quot;,</span><br><span class="line">&quot;system&quot; : &quot;windows&quot;,</span><br><span class="line">&quot;and&quot; : true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> server：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;_id&quot; : ObjectId(&quot;5aca096d5e2ba50ef1a75c5c&quot;),</span><br><span class="line">&quot;netloc&quot; : &quot;192.168.1.5:33433&quot;,</span><br><span class="line">&quot;uptime&quot; : ISODate(&quot;2018-04-13T12:47:34.678Z&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong> statistics: </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5aca09915e2ba50ef1ac00ab&quot;), &quot;uptime&quot; : ISODate(&quot;2018-04-11T12:35:13.782Z&quot;), &quot;type&quot; : &quot;loginlog&quot;, &quot;info&quot; : &quot;192.168.1.6&quot;, &quot;count&quot; : 30, &quot;server_list&quot; : [ &quot;192.168.1.4&quot;, &quot;192.168.1.5&quot; ]&#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5aca09915e2ba50ef1ac00b8&quot;), &quot;type&quot; : &quot;loginlog&quot;, &quot;info&quot; : &quot;192.168.1.7&quot;, &quot;count&quot; :12, &quot;server_list&quot; : [ &quot;192.168.1.4&quot;, &quot;192.168.1.5&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-09T09:05:48.640Z&quot;)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5aca09915e2ba50ef1ac00b4&quot;), &quot;type&quot; : &quot;userlist&quot;, &quot;info&quot; : &quot;root&quot;, &quot;count&quot; : 4, &quot;server_list&quot; : [ &quot;192.168.1.4&quot;, &quot;192.168.1.5&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-09T09:05:48.640Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acf1f5e5e2ba50ef1fb4e28&quot;), &quot;type&quot; : &quot;userlist&quot;, &quot;info&quot; : &quot;piasdf$&quot;, &quot;count&quot; : 7,&quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-12T12:35:53.264Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5aca09915e2ba50ef1ac00b6&quot;), &quot;info&quot; : &quot;0.0.0.0:5266&quot;, &quot;count&quot; : 7, &quot;server_list&quot; :[ &quot;192.168.1.4&quot;, &quot;192.168.1.5&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-12T18:21:44.314Z&quot;), &quot;type&quot; : &quot;listening&quot; &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5aca0bc25e2ba50ef1e3542a&quot;), &quot;type&quot; : &quot;listening&quot;, &quot;info&quot; : &quot;0.0.0.0:443&quot;, &quot;count&quot;: 4, &quot;server_list&quot; : [ &quot;192.168.1.5&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-12T18:21:44.314Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5aca0bc25e2ba50ef1e353e0&quot;), &quot;type&quot; : &quot;crontab&quot;, &quot;info&quot; : &quot;/usr/bin/test -f  /tmp/lockfile &gt;/dev/null || /opt/apple/apps/ddd/tool 2 &gt;/dev/null &amp;&amp; /bin/touch /tmp/lock&quot;, &quot;count&quot; : 1, &quot;server_list&quot; : [ &quot;192.168.1.5&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-08T12:32:02.633Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acadea05e2ba50ef1a55877&quot;), &quot;type&quot; : &quot;crontab&quot;, &quot;info&quot; : &quot;c:\\windows\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe&quot;, &quot;count&quot; : 16, &quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-12T12:35:53.233Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acadea95e2ba50ef1a630c8&quot;), &quot;type&quot; : &quot;connection&quot;, &quot;info&quot; : &quot;111.206.79.165&quot;, &quot;count&quot; : 4987, &quot;server_list&quot; : [ &quot;192.168.1.1&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-11T12:53:15.086Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acae3135e2ba50ef11946e6&quot;), &quot;type&quot; : &quot;connection&quot;, &quot;info&quot; : &quot;123.125.80.36&quot;, &quot;count&quot; : 1, &quot;server_list&quot; : [ &quot;192.168.1.1&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-09T03:50:43.619Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acf23575e2ba50ef16296eb&quot;), &quot;type&quot; : &quot;process&quot;, &quot;info&quot; : &quot;w3wp.exe&quot;, &quot;count&quot; : 6,&quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-13T12:43:03.017Z&quot;) &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acf32385e2ba50ef1e5ee42&quot;), &quot;info&quot; : &quot;HipsMain.exe&quot;, &quot;count&quot; : 3, &quot;server_list&quot; :[ &quot;192.168.1.1&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-12T12:39:49.601Z&quot;), &quot;type&quot; : &quot;process&quot; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acadea05e2ba50ef1a5587a&quot;), &quot;uptime&quot; : ISODate(&quot;2018-04-12T12:35:53.232Z&quot;), &quot;type&quot; : &quot;startup&quot;, &quot;info&quot; : &quot;360sd&quot;, &quot;count&quot; : 18, &quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ] &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acadea05e2ba50ef1a55886&quot;), &quot;count&quot; : 18, &quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-12T12:35:53.232Z&quot;), &quot;type&quot; : &quot;startup&quot;, &quot;info&quot; : &quot;AnyDesk&quot; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acae2665e2ba50ef107caa7&quot;), &quot;type&quot; : &quot;service&quot;, &quot;info&quot; : &quot;hidserv&quot;, &quot;count&quot; : 114, &quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-13T11:41:20.587Z&quot;) &#125;</span><br><span class="line"></span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5acae2665e2ba50ef107cbe7&quot;), &quot;type&quot; : &quot;service&quot;, &quot;info&quot; : &quot;SQLBrowser&quot;, &quot;count&quot; : 114, &quot;server_list&quot; : [ &quot;192.168.1.1&quot;, &quot;192.168.1.2&quot;, &quot;192.168.1.3&quot; ], &quot;uptime&quot; : ISODate(&quot;2018-04-13T11:41:20.587Z&quot;) &#125;</span><br></pre></td></tr></table></figure>
<h2 id="六、入侵检测功能点和维度"><a href="#六、入侵检测功能点和维度" class="headerlink" title="六、入侵检测功能点和维度"></a>六、入侵检测功能点和维度</h2><blockquote>
<p>[server]-&gt;ScanMonitorThread(安全检测线程)-&gt;Run(开始检测)-&gt;BlackFilter(黑名单)-&gt;WhiteFilter(白名单)-&gt;Rules(规则引擎)-&gt;Intelligence(威胁情报)</p>
</blockquote>
<h3 id="1-webshell写入行为"><a href="#1-webshell写入行为" class="headerlink" title="1. webshell写入行为"></a>1. webshell写入行为</h3><p>Linux目前支持Apache和nginx的目录自动监控：</p>
<p>apachectl -V</p>
<p>nginx -V</p>
<p>Windows目前支持IIS6和IIS7：</p>
<p>先在初始化时获取进程列表存库，如果获取到web进程，并web标签入库，则收集web目录，并进行监控：</p>
<p>x32<br>iis6配置文件:%SystemDrive%\WINDOWS\SysNative\inetsrv\MetaBase.xml<br>iis7配置文件:%SystemDrive%\Windows\SysNative\inetsrv\config\applicationHost.config</p>
<p> x64<br>iis6配置文件:%SystemDrive%\WINDOWS\System32\inetsrv\MetaBase.xml<br>iis7配置文件:%SystemDrive%\Windows\System32\inetsrv\config\applicationHost.config</p>
<h4 id="识别模式："><a href="#识别模式：" class="headerlink" title="识别模式："></a>识别模式：</h4><p>1）文件监控，通过监控文件WRITE行为，正则匹配文件的后缀类型为黑名单中的后缀进行匹配。bypass 中文.aspx<br>2）进程监控，父进程是web服务，执行子进程是黑名单进程中的进程名字或命令。</p>
<h3 id="2-异常登录、网络连接行为"><a href="#2-异常登录、网络连接行为" class="headerlink" title="2.异常登录、网络连接行为"></a>2.异常登录、网络连接行为</h3><p>统计第n次出现的登录ip、登录用户名告警，原则上MongoDB的statistics表里loginlog（登录的ip）、userlist（登录的用户）、listening（ip监听端口）、crontab（计划任务）、process（进程名字）、startup（启动项名字）、service（服务名字）都存在count字段，都可以通过自定义规则进行告警。</p>
<h4 id="识别模式：-1"><a href="#识别模式：-1" class="headerlink" title="识别模式："></a>识别模式：</h4><p>1）进程监控</p>
<p>2）文件监控，登录日志windows<a href="https://mp.weixin.qq.com/s/rHDJ2tQWEaZLikMt5bgCsw" target="_blank">《驭龙 EventLog 读取模块的迭代历程》</a>，Linux 登录成功（解析/var/log/wtmp）、登录失败lastb命令；</p>
<p>3）网络流量</p>
<h3 id="3-异常命令调用行为"><a href="#3-异常命令调用行为" class="headerlink" title="3.异常命令调用行为"></a>3.异常命令调用行为</h3><p><a href="http://www.cnblogs.com/LittleHann/p/3854977.html" target="_blank">《Linux System Calls Hooking Method Summary》</a>、<a href="https://mp.weixin.qq.com/s?__biz=MzUzODQ0ODkyNA==&mid=2247483854&idx=2&sn=815883b02ab0000956959f78c3f31e2b&scene=21#wechat_redirect" target="_blank">《如何在Linux下监控命令执行》</a>、<a href="https://mp.weixin.qq.com/s/ntE5FNM8UaXQFC5l4iKUUw" target="_blank">《「驭龙」Linux执行命令监控驱动实现解析》</a></p>
<p>在驭龙hids官方git上的演示sql注入和命令执行，实际上跟我们平时理解的waf有所区别，没有对web请求进行监控。而是通过规则定义了sqlsrver.exe启动子进程为cmd.exe的调用关系，而在sqlserver上通过xp_cmdshell执行命令就是通过cmd间接执行其他命令的。</p>
<p><img src="/2018/04/20/yulong-hids/360-cmd.png" alt="360主动拦截"></p>
<p><img src="/2018/04/20/yulong-hids/process-call.jpeg" alt="进程调用"></p>
<p>在3gstudent和evi1cg.me的博客上有关于win下文件下载、命令执行和sqlserver执行命令的一些姿势，如果理清楚进程的调用关系，相信你一定可以绕过某些安全软件的动作拦截，包括msf的payload去开shell等。</p>
<h4 id="识别模式：-2"><a href="#识别模式：-2" class="headerlink" title="识别模式："></a>识别模式：</h4><p>1）进程监控，通过规则定义进程调用关系进行告警</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>没有小结~</p>
</div><div class="post-copyright"><blockquote><p>原文作者: pirogue</p><p>原文链接: <a href="http://pirogue.org/2018/04/20/yulong-hids/">http://pirogue.org/2018/04/20/yulong-hids/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/安全建设/">安全建设</a><a href="/tags/渗透测试/">渗透测试</a><a href="/tags/hids/">hids</a><a href="/tags/驭龙hids/">驭龙hids</a><a href="/tags/安全开发/">安全开发</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2018/06/26/phishing/" class="pre">甲方企业安全建设之钓鱼实践的一种姿势</a><a href="/2018/02/27/oss_upload_vul/" class="next">OSS对象存储上传解析漏洞预警</a></div><div id="comments"><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="comment"></div><script type="text/javascript">new Valine({
  el: '#comment',  
  notify: false, 
  verify: false, 
  app_id: 'LxlH8totxFLNwkT4nTy2ccay-gzGzoHsz',
  appKey: 'Pzf3CsqHnjhKJryLexrAy45U',
  // 评论框占位符
  placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',  
  // 当前文章页路径，用于区分不同的文章页，以保证正确读取该文章页下的评论列表
  path:window.location.pathname,  
  // 默认头像类型
  avatar: 'wavatar',
  // 每页展示评论条数
  pageSize: 15
});</script></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、进程实时监控"><span class="toc-text">一、进程实时监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、网络链接实时监控"><span class="toc-text">二、网络链接实时监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、文件操作实时监控"><span class="toc-text">三、文件操作实时监控</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、ES索引类型字段"><span class="toc-text">四、ES索引类型字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、MongoDB数据库"><span class="toc-text">五、MongoDB数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、入侵检测功能点和维度"><span class="toc-text">六、入侵检测功能点和维度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-webshell写入行为"><span class="toc-text">1. webshell写入行为</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#识别模式："><span class="toc-text">识别模式：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-异常登录、网络连接行为"><span class="toc-text">2.异常登录、网络连接行为</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#识别模式：-1"><span class="toc-text">识别模式：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-异常命令调用行为"><span class="toc-text">3.异常命令调用行为</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#识别模式：-2"><span class="toc-text">识别模式：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结"><span class="toc-text">小结</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/12/14/bacscanner/">越权扫描器碎碎念</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/24/quant/">币圈量化交易试水</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/22/golangxml/">被动扫描器研发（1）：golang生成cdata xml格式数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/17/awvs/">awvs（12.0.190515149）linux 安装和破解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/opencanary_2/">opencanary二次开发(1)-日志格式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/09/opencanary_1/">蜜罐正式开源-简单易用-支持16种协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/17/SPA/">前后端分离开发风险浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/14/异地恋/">异地恋</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/26/phishing/">甲方企业安全建设之钓鱼实践的一种姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/20/yulong-hids/">驭龙hids入侵检测功能初探</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/安全建设/">安全建设</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全开发/">安全开发</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全运维/">安全运维</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作生活/">工作生活</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/">渗透测试</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/诗和远方/">诗和远方</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化交易/">量化交易</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Phishing/" style="font-size: 15px;">Phishing</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/运维/" style="font-size: 15px;">运维</a> <a href="/tags/审计策略/" style="font-size: 15px;">审计策略</a> <a href="/tags/安全建设/" style="font-size: 15px;">安全建设</a> <a href="/tags/甲方安全/" style="font-size: 15px;">甲方安全</a> <a href="/tags/前后端分离/" style="font-size: 15px;">前后端分离</a> <a href="/tags/开发/" style="font-size: 15px;">开发</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/渗透测试/" style="font-size: 15px;">渗透测试</a> <a href="/tags/文件上传漏洞/" style="font-size: 15px;">文件上传漏洞</a> <a href="/tags/阿里云OSS/" style="font-size: 15px;">阿里云OSS</a> <a href="/tags/awvs/" style="font-size: 15px;">awvs</a> <a href="/tags/漏洞扫描器/" style="font-size: 15px;">漏洞扫描器</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/回调函数/" style="font-size: 15px;">回调函数</a> <a href="/tags/脏牛/" style="font-size: 15px;">脏牛</a> <a href="/tags/dirtycow/" style="font-size: 15px;">dirtycow</a> <a href="/tags/CVE-2016-5195/" style="font-size: 15px;">CVE-2016-5195</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/留言板/" style="font-size: 15px;">留言板</a> <a href="/tags/CVE-2017-7525/" style="font-size: 15px;">CVE-2017-7525</a> <a href="/tags/CVE-2017-17485/" style="font-size: 15px;">CVE-2017-17485</a> <a href="/tags/Jackson-databind反序列化漏洞/" style="font-size: 15px;">Jackson-databind反序列化漏洞</a> <a href="/tags/安全分析/" style="font-size: 15px;">安全分析</a> <a href="/tags/蜜罐/" style="font-size: 15px;">蜜罐</a> <a href="/tags/开源/" style="font-size: 15px;">开源</a> <a href="/tags/opencanary/" style="font-size: 15px;">opencanary</a> <a href="/tags/OSS对象存储/" style="font-size: 15px;">OSS对象存储</a> <a href="/tags/上传漏洞/" style="font-size: 15px;">上传漏洞</a> <a href="/tags/解析漏洞/" style="font-size: 15px;">解析漏洞</a> <a href="/tags/漏洞预警/" style="font-size: 15px;">漏洞预警</a> <a href="/tags/截屏/" style="font-size: 15px;">截屏</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/信息安全/" style="font-size: 15px;">信息安全</a> <a href="/tags/黑客/" style="font-size: 15px;">黑客</a> <a href="/tags/信息收集/" style="font-size: 15px;">信息收集</a> <a href="/tags/系统/" style="font-size: 15px;">系统</a> <a href="/tags/钓鱼/" style="font-size: 15px;">钓鱼</a> <a href="/tags/poster模块/" style="font-size: 15px;">poster模块</a> <a href="/tags/上传/" style="font-size: 15px;">上传</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/QQ邮箱/" style="font-size: 15px;">QQ邮箱</a> <a href="/tags/ssrf/" style="font-size: 15px;">ssrf</a> <a href="/tags/w3af/" style="font-size: 15px;">w3af</a> <a href="/tags/诗歌/" style="font-size: 15px;">诗歌</a> <a href="/tags/配置文件/" style="font-size: 15px;">配置文件</a> <a href="/tags/xml/" style="font-size: 15px;">xml</a> <a href="/tags/cdata/" style="font-size: 15px;">cdata</a> <a href="/tags/burpsuite/" style="font-size: 15px;">burpsuite</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/二次开发/" style="font-size: 15px;">二次开发</a> <a href="/tags/btc/" style="font-size: 15px;">btc</a> <a href="/tags/量化交易/" style="font-size: 15px;">量化交易</a> <a href="/tags/CVE-2017-10271/" style="font-size: 15px;">CVE-2017-10271</a> <a href="/tags/java反序列化/" style="font-size: 15px;">java反序列化</a> <a href="/tags/weblogic反序列化漏洞/" style="font-size: 15px;">weblogic反序列化漏洞</a> <a href="/tags/XMLDecoder反序列化漏洞/" style="font-size: 15px;">XMLDecoder反序列化漏洞</a> <a href="/tags/工作生活/" style="font-size: 15px;">工作生活</a> <a href="/tags/乙方安全/" style="font-size: 15px;">乙方安全</a> <a href="/tags/启动流程/" style="font-size: 15px;">启动流程</a> <a href="/tags/账户管理/" style="font-size: 15px;">账户管理</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/Web自动化攻击平台/" style="font-size: 15px;">Web自动化攻击平台</a> <a href="/tags/Apache-Commons-Collections/" style="font-size: 15px;">Apache Commons Collections</a> <a href="/tags/反弹shell/" style="font-size: 15px;">反弹shell</a> <a href="/tags/安全监控/" style="font-size: 15px;">安全监控</a> <a href="/tags/exp/" style="font-size: 15px;">exp</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/网络安全/" style="font-size: 15px;">网络安全</a> <a href="/tags/hids/" style="font-size: 15px;">hids</a> <a href="/tags/驭龙hids/" style="font-size: 15px;">驭龙hids</a> <a href="/tags/安全开发/" style="font-size: 15px;">安全开发</a> <a href="/tags/越权/" style="font-size: 15px;">越权</a> <a href="/tags/扫描器/" style="font-size: 15px;">扫描器</a> <a href="/tags/Wazuh/" style="font-size: 15px;">Wazuh</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">20</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.0x001.com/" title="0x001" target="_blank">0x001</a><ul></ul><a href="http://ksowo.com/" title="lyy" target="_blank">lyy</a><ul></ul><a href="http://xxlegend.com/" title="xxlegend" target="_blank">xxlegend</a><ul></ul><a href="https://bl4ck.in/" title="Tomato" target="_blank">Tomato</a><ul></ul><a href="https://my.oschina.net/9199771" title="超级大黑猫" target="_blank">超级大黑猫</a><ul></ul><a href="https://www.weiho.xyz/" title="Weiho" target="_blank">Weiho</a><ul></ul><a href="https://www.maliciouskr.cc/" title="MaliciousKr" target="_blank">MaliciousKr</a><ul></ul><a href="http://www.lshack.cn/" title="lsh4ck's blog" target="_blank">lsh4ck's blog</a><ul></ul><a href="https://www.0x002.com" title="Yunen's blog" target="_blank">Yunen's blog</a><ul></ul><a href="https://www.dp2px.com/" title="水寒的博客" target="_blank">水寒的博客</a><ul></ul><a href="https://www.pa55w0rd.online/" title="Pa55w0rd's blog" target="_blank">Pa55w0rd's blog</a><ul></ul><a href="http://www.mianhuage.com/" title="Cotton's Blog" target="_blank">Cotton's Blog</a><ul></ul><a href="https://zgao.top/" title="zgao" target="_blank">zgao</a><ul></ul><a href="http://lab.orchina.org/" title="糖果的实验室" target="_blank">糖果的实验室</a><ul></ul><a href="https://www.ms17010.net/" title="yd" target="_blank">yd</a><ul></ul><a href="http://blog.leanote.com/snowming" title="snowming" target="_blank">snowming</a><ul></ul><a href="https://www.cnblogs.com/ssooking" title="ssooking" target="_blank">ssooking</a><br>
<br>
『将定期清理无法访问的友情链接』</div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">pirogue.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-92976027-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>