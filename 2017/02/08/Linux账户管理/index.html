<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一个信息安全从业者的博客"><meta name="keywords" content="信息安全, 网络安全, 黑客, 渗透测试, Linux安全运维, 安全开发, python"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>Linux账户管理 | pirogue</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Linux账户管理</h1><a id="logo" href="/.">pirogue</a><p class="description">你曾听过一个地方，到达之时我们将拥有一切吗？</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Linux账户管理</h1><div class="post-meta"><a href="/2017/02/08/Linux账户管理/#comments" class="comment-count"></a><p><span class="date">Feb 08, 2017</span><span><a href="/categories/安全运维/" class="category">安全运维</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="1-用户信息与密码的配置文件"><a href="#1-用户信息与密码的配置文件" class="headerlink" title="1. 用户信息与密码的配置文件"></a>1. 用户信息与密码的配置文件</h2><h3 id="1-用户信息文件：-etc-passwd"><a href="#1-用户信息文件：-etc-passwd" class="headerlink" title="1) 用户信息文件：     /etc/passwd"></a>1) 用户信息文件：     /etc/passwd</h3><a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line">gopher:x:13:30:gopher:/var/gopher:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin</span><br><span class="line">saslauth:x:499:76:&quot;Saslauthd user&quot;:/var/empty/saslauth:/sbin/nologin</span><br><span class="line">postfix:x:89:89::/var/spool/postfix:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br></pre></td></tr></table></figure>
<blockquote>
<p>每一行内容存放一个用户的信息，每个用户信息有7部分组成。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">通过“冒号”分割，解释说明：</span><br><span class="line">root        用户名           用户登录系统时使用的用户名</span><br><span class="line">x           密码             密码位</span><br><span class="line">0           UID             用户标示号</span><br><span class="line">0           GID             缺省组标示</span><br><span class="line">root        注释性描述       例如存放用户全名等信息</span><br><span class="line">/root       宿主目录         用户登录系统后的缺省目录</span><br><span class="line">/bin/bash   命令解释器       用户使用的Shell，默认为bash</span><br><span class="line">/sbin/nologin 表示该账号不能用来登录Linux系统</span><br></pre></td></tr></table></figure>
<p>sh(BourneShell),csh(CShell),ksh(KornShell),tcsh(TENEX/TOPS-20typeCShell),bash(BourneAgainShell)等。</p>
<blockquote>
<blockquote>
<p>密码位</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最早的Linux这个位置真的是放密码的，但因为不安全，所以就将密码单独存放在了/etc/shadow中。</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>UID 决定了用户权限而不是用户名。</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux用户分为三种：超级用户（root UID=0）,普通用户（CentOS6 UID 500~60000|CentOS7 UID 1000-60000），伪用户或叫系统用户、虚拟用户、假用户（Centos6 UID 1~499|Centos7 UID 1~999）</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>伪用户</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">A.</span><br><span class="line">bin、daemon、shutdown、halt等，任何Linux系统默认都有这些伪用户。</span><br><span class="line">mail、news、games、apache、ftp、mysql及sshd等，与Linux的进程相关。</span><br><span class="line">B.</span><br><span class="line">伪用户通常不需要或无法登陆系统</span><br><span class="line">C.</span><br><span class="line">可以没有宿主目录</span><br></pre></td></tr></table></figure>
<h3 id="2）密码文件：-etc-shadow"><a href="#2）密码文件：-etc-shadow" class="headerlink" title="2）密码文件：         /etc/shadow"></a>2）密码文件：         /etc/shadow</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -al /etc/shadow</span><br><span class="line">----------. 1 root root 592 Feb  6 18:03 /etc/shadow</span><br></pre></td></tr></table></figure>
<blockquote>
<p>密码文件内容</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/shadow</span><br><span class="line">root:$6$IglT.f7rqrwKA7tJ$1YXkCR3shYkNopl03UaIrBf7e1PUW9JXkxlpHg4sb8MPKy4xYqFVelynW7Ww6F.x1nfqKknJZzE6n7vKENAZP0:17203:0:99999:7:::</span><br><span class="line">bin:*:15628:0:99999:7:::</span><br><span class="line">daemon:*:15628:0:99999:7:::</span><br><span class="line">adm:*:15628:0:99999:7:::</span><br><span class="line">lp:*:15628:0:99999:7:::</span><br><span class="line">sync:*:15628:0:99999:7:::</span><br><span class="line">shutdown:*:15628:0:99999:7:::</span><br><span class="line">halt:*:15628:0:99999:7:::</span><br><span class="line">mail:*:15628:0:99999:7:::</span><br><span class="line">uucp:*:15628:0:99999:7:::</span><br><span class="line">operator:*:15628:0:99999:7:::</span><br><span class="line">games:*:15628:0:99999:7:::</span><br><span class="line">gopher:*:15628:0:99999:7:::</span><br><span class="line">ftp:*:15628:0:99999:7:::</span><br><span class="line">nobody:*:15628:0:99999:7:::</span><br><span class="line">vcsa:!!:17203::::::</span><br><span class="line">saslauth:!!:17203::::::</span><br><span class="line">postfix:!!:17203::::::</span><br><span class="line">sshd:!!:17203::::::</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>密码文件说明</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root:$6$IglT.f7rqrwKA7tJ$1YXkCR3shYkNopl03UaIrBf7e1PUW9JXkxlpHg4sb8MPKy4xYqFVelynW7Ww6F.x1nfqKknJZzE6n7vKENAZP0:17203:0:99999:7:::</span><br><span class="line"></span><br><span class="line">root 用户名 用户登录系统时使用的用户名</span><br><span class="line">$6$IglT.f7rqrwKA7tJ$1YXkCR3shYkNopl03UaIrBf7e1PUW9JXkxlpHg4sb8MPKy4xYqFVelynW7Ww6F.x1nfqKknJZzE6n7vKENAZP0 密码</span><br><span class="line">17203  最后一次修改时间    Linux这里以1970年1月1日作为1,1971年1月1日就是366，依次类推到我修改密码的日期表示为17203。</span><br><span class="line">0                   最小时间间隔        这个字段代表要经过多久才可以更改密码。0表示密码可以随时更改。</span><br><span class="line">99999               最大时间间隔        由于害怕密码被人盗取而危害到整个系统的安全，所以安排了这个字段，你必须在这个时间内重新修改密码，否则这个账号将暂时失效。99999表示密码不需要重新输入，最好设定一段时间修改密码，确保系统安全。</span><br><span class="line">7                   密码变更期期限快到前的警告期：当账号的密码失效期限快到时，系统依据这个字段的设定发出警告，提醒用户“再过n天您的密码将过期，请尽快重新设定密码。”默认是7天。</span><br><span class="line">账号失效期： 如果用户过了警告期没有重新输入密码，使得密码失效，而该用户在这个字段限定的时间内又没有向管理员反映，让账号重新启用，那么这个账号将暂时失效。</span><br><span class="line">账号取消日期：这个日期跟第三个字段一样，都是使用1970年以来的日期设定方法。这个字段表示，这个账号在此字段规定的日期之后将无法再使用。这个字段常用于收费服务系统中，可以规定一个日期让该账号不能再使用。</span><br><span class="line">保留： 最后一个字段是保留的，看以后有没有新功能加入。</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>加密方式说明$id$salt$encrypted</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$6$ 开头的，表明是用SHA-512加密。</span><br><span class="line">$1$ 表明是用MD5加密。</span><br><span class="line">$2$ 是用Blowfish加密的。</span><br><span class="line">$5$ 是用SHA-256加密。</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>shadow文件保存了密码，而passwd文件中没有保存密码，为什么不把passwd文件中的密码位取消掉？</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# grep root /etc/passwd /etc/shadow</span><br><span class="line">/etc/passwd:root:x:0:0:root:/root:/bin/bash</span><br><span class="line">/etc/passwd:operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">/etc/shadow:root:$6$IglT.f7rqrwKA7tJ$1YXkCR3shYkNopl03UaIrBf7e1PUW9JXkxlpHg4sb8MPKy4xYqFVelynW7Ww6F.x1nfqKknJZzE6n7vKENAZP0:17203:0:99999:7:::</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# pwunconv                将密码回写</span><br><span class="line">[root@localhost ~]# grep root /etc/passwd /etc/shadow</span><br><span class="line">/etc/passwd:root:$6$IglT.f7rqrwKA7tJ$1YXkCR3shYkNopl03UaIrBf7e1PUW9JXkxlpHg4sb8MPKy4xYqFVelynW7Ww6F.x1nfqKknJZzE6n7vKENAZP0:0:0:root:/root:/bin/bash</span><br><span class="line">/etc/passwd:operator:*:11:0:operator:/root:/sbin/nologin</span><br><span class="line">grep: /etc/shadow: No such file or directory</span><br><span class="line">[root@localhost ~]# ls /etc/shadow</span><br><span class="line">ls: cannot access /etc/shadow: No such file or directory</span><br><span class="line"></span><br><span class="line">但此时依然可通过用户名、密码登录：</span><br><span class="line">[c:\~]$ ssh 192.168.0.128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Connecting to 192.168.0.128:22...</span><br><span class="line">Connection established.</span><br><span class="line">To escape to local shell, press &apos;Ctrl+Alt+]&apos;.</span><br><span class="line"></span><br><span class="line">Last login: Tue Feb  7 09:55:23 2017 from 192.168.0.1</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# pwconv          转换到shadow文件中，只不过这个动作平时由Linux自动完成。</span><br><span class="line">[root@localhost ~]# grep root /etc/passwd /etc/shadow</span><br><span class="line">/etc/passwd:root:x:0:0:root:/root:/bin/bash</span><br><span class="line">/etc/passwd:operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">/etc/shadow:root:$6$IglT.f7rqrwKA7tJ$1YXkCR3shYkNopl03UaIrBf7e1PUW9JXkxlpHg4sb8MPKy4xYqFVelynW7Ww6F.x1nfqKknJZzE6n7vKENAZP0:17204:0:99999:7:::</span><br></pre></td></tr></table></figure>
<h3 id="3）用户组文件：-etc-group"><a href="#3）用户组文件：-etc-group" class="headerlink" title="3）用户组文件：       /etc/group"></a>3）用户组文件：       /etc/group</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:bin,daemon</span><br><span class="line">daemon:x:2:bin,daemon</span><br><span class="line">sys:x:3:bin,adm</span><br><span class="line">adm:x:4:adm,daemon</span><br><span class="line">tty:x:5:</span><br><span class="line">disk:x:6:</span><br><span class="line">lp:x:7:daemon</span><br><span class="line">mem:x:8:</span><br><span class="line">kmem:x:9:</span><br><span class="line">wheel:x:10:</span><br><span class="line">mail:x:12:mail,postfix</span><br><span class="line">uucp:x:14:</span><br><span class="line">man:x:15:</span><br><span class="line">games:x:20:</span><br><span class="line">gopher:x:30:</span><br><span class="line">video:x:39:</span><br><span class="line">dip:x:40:</span><br><span class="line">ftp:x:50:</span><br><span class="line">lock:x:54:</span><br><span class="line">audio:x:63:</span><br><span class="line">nobody:x:99:</span><br><span class="line">users:x:100:</span><br><span class="line">utmp:x:22:</span><br><span class="line">utempter:x:35:</span><br><span class="line">floppy:x:19:</span><br><span class="line">vcsa:x:69:</span><br><span class="line">cdrom:x:11:</span><br><span class="line">tape:x:33:</span><br><span class="line">dialout:x:18:</span><br><span class="line">saslauth:x:76:</span><br><span class="line">postdrop:x:90:</span><br><span class="line">postfix:x:89:</span><br><span class="line">sshd:x:74:</span><br></pre></td></tr></table></figure>
<blockquote>
<p>group配置文件说明<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:</span><br><span class="line">第一字段：是用户组的名称，有字幕或数字构成。与/etc/passwd中的登录名一样，组名不应重复。</span><br><span class="line">第二字段：字段存放的是用户组加密后的密码。一般为是x，因为密码存在/etc/gshadow。</span><br><span class="line">第三字段：与用户标识号类似，也是一个整数，被系统内部用来表示组。</span><br><span class="line">第四字段：是属于这个组的所有用户的列表，不同用户之间用逗号分隔。这个用户组可能是用户的主组，也可能是附加组。</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="4）用户组密码文件：-etc-gshadow"><a href="#4）用户组密码文件：-etc-gshadow" class="headerlink" title="4）用户组密码文件：   /etc/gshadow"></a>4）用户组密码文件：   /etc/gshadow</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/gshadow</span><br><span class="line">root:::</span><br><span class="line">bin:::bin,daemon</span><br><span class="line">daemon:::bin,daemon</span><br><span class="line">sys:::bin,adm</span><br><span class="line">adm:::adm,daemon</span><br><span class="line">tty:::</span><br><span class="line">disk:::</span><br><span class="line">lp:::daemon</span><br><span class="line">mem:::</span><br><span class="line">kmem:::</span><br><span class="line">wheel:::</span><br><span class="line">mail:::mail,postfix</span><br><span class="line">uucp:::</span><br><span class="line">man:::</span><br><span class="line">games:::</span><br><span class="line">gopher:::</span><br><span class="line">video:::</span><br><span class="line">dip:::</span><br><span class="line">ftp:::</span><br><span class="line">lock:::</span><br><span class="line">audio:::</span><br><span class="line">nobody:::</span><br><span class="line">users:::</span><br><span class="line">utmp:!::</span><br><span class="line">utempter:!::</span><br><span class="line">floppy:!::</span><br><span class="line">vcsa:!::</span><br><span class="line">cdrom:!::</span><br><span class="line">tape:!::</span><br><span class="line">dialout:!::</span><br><span class="line">saslauth:!::</span><br><span class="line">postdrop:!::</span><br><span class="line">postfix:!::</span><br><span class="line">sshd:!::</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在gshadow配置文件说明</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root:*::</span><br><span class="line">第一字段：是用户组的名称，由字母或数字构成。与/etc/group中的登录名一样。</span><br><span class="line">第二字段：字段存放的是用户组加密后的密码。如果开头为！表示无合法密码。</span><br><span class="line">第三字段：用户组管理员的所属帐号。</span><br><span class="line">第四字段：该用户组所属帐号。与/etc/group中的一样</span><br><span class="line">一个账户可以有多个用户组，当前时刻所属的用户组成为有效用户组。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>查询当前有效用户组</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# groups</span><br><span class="line">root</span><br><span class="line">此时创建的文件的用户组就所属有效用户组root。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>更改有效用户组：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">newgrp xxx</span><br><span class="line">groups</span><br><span class="line">xxx root</span><br><span class="line">第一列出的就是当前有效用户组</span><br></pre></td></tr></table></figure>
<h3 id="5）用户配置文件：-etc-login-defs、-etc-default-useradd"><a href="#5）用户配置文件：-etc-login-defs、-etc-default-useradd" class="headerlink" title="5）用户配置文件：/etc/login.defs、/etc/default/useradd"></a>5）用户配置文件：/etc/login.defs、/etc/default/useradd</h3><blockquote>
<p>当我们新建用户时，通过/etc/login.defs和/etc/default/useradd 两文件实现新用户的基本设置。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/login.defs </span><br><span class="line">#</span><br><span class="line"># Please note that the parameters in this configuration file control the</span><br><span class="line"># behavior of the tools from the shadow-utils component. None of these</span><br><span class="line"># tools uses the PAM mechanism, and the utilities that use PAM (such as the</span><br><span class="line"># passwd command) should therefore be configured elsewhere. Refer to</span><br><span class="line"># /etc/pam.d/system-auth for more information.</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># *REQUIRED*</span><br><span class="line">#   Directory where mailboxes reside, _or_ name of file, relative to the</span><br><span class="line">#   home directory.  If you _do_ define both, MAIL_DIR takes precedence.</span><br><span class="line">#   QMAIL_DIR is for Qmail</span><br><span class="line">#</span><br><span class="line">#QMAIL_DIR	Maildir</span><br><span class="line">MAIL_DIR	/var/spool/mail</span><br><span class="line">#MAIL_FILE	.mail</span><br><span class="line"></span><br><span class="line"># Password aging controls:</span><br><span class="line">#</span><br><span class="line">#	PASS_MAX_DAYS	Maximum number of days a password may be used.</span><br><span class="line">#	PASS_MIN_DAYS	Minimum number of days allowed between password changes.</span><br><span class="line">#	PASS_MIN_LEN	Minimum acceptable password length.</span><br><span class="line">#	PASS_WARN_AGE	Number of days warning given before a password expires.</span><br><span class="line">#</span><br><span class="line">PASS_MAX_DAYS	99999</span><br><span class="line">PASS_MIN_DAYS	0</span><br><span class="line">PASS_MIN_LEN	5</span><br><span class="line">PASS_WARN_AGE	7</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Min/max values for automatic uid selection in useradd</span><br><span class="line">#</span><br><span class="line">UID_MIN			  500</span><br><span class="line">UID_MAX			60000</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Min/max values for automatic gid selection in groupadd</span><br><span class="line">#</span><br><span class="line">GID_MIN			  500</span><br><span class="line">GID_MAX			60000</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># If defined, this command is run when removing a user.</span><br><span class="line"># It should remove any at/cron/print jobs etc. owned by</span><br><span class="line"># the user to be removed (passed as the first argument).</span><br><span class="line">#</span><br><span class="line">#USERDEL_CMD	/usr/sbin/userdel_local</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># If useradd should create home directories for users by default</span><br><span class="line"># On RH systems, we do. This option is overridden with the -m flag on</span><br><span class="line"># useradd command line.</span><br><span class="line">#</span><br><span class="line">CREATE_HOME	yes</span><br><span class="line"></span><br><span class="line"># The permission mask is initialized to this value. If not specified, </span><br><span class="line"># the permission mask will be initialized to 022.</span><br><span class="line">UMASK           077</span><br><span class="line"></span><br><span class="line"># This enables userdel to remove user groups if no members exist.</span><br><span class="line">#</span><br><span class="line">USERGROUPS_ENAB yes</span><br><span class="line"></span><br><span class="line"># Use SHA512 to encrypt password.</span><br><span class="line">ENCRYPT_METHOD SHA512</span><br></pre></td></tr></table></figure>
<blockquote>
<p>/etc/login.defs配置文件说明</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MAIL_DIR	/var/spool/mail         邮件默认目录存放处</span><br><span class="line"></span><br><span class="line">PASS_MAX_DAYS	99999               密码需要变更时间</span><br><span class="line">PASS_MIN_DAYS	0                   密码多久需要变更</span><br><span class="line">PASS_MIN_LEN	5                   密码最小长度</span><br><span class="line">PASS_WARN_AGE	7                   密码失效之前几天发送警告信息</span><br><span class="line"></span><br><span class="line">UID_MIN			  500               默认账号起始的最小UID数</span><br><span class="line">UID_MAX			60000               最大的UID限制</span><br><span class="line"></span><br><span class="line">GID_MIN			  500               默认账号起始的最小GID数</span><br><span class="line">GID_MAX			60000               最大的GID限制</span><br><span class="line"></span><br><span class="line">CREATE_HOME	yes                     是否建立用户根目录，默认是“yes”，如果选择“no”，就是不建立</span><br><span class="line"></span><br><span class="line">ENCRYPT_METHOD SHA512               采用SHA512加密</span><br></pre></td></tr></table></figure>
<blockquote>
<p>/etc/default/useradd配置文件说明</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/default/useradd </span><br><span class="line"># useradd defaults file</span><br><span class="line">GROUP=100               默认用户群组为100</span><br><span class="line">HOME=/home              默认用户的根目录</span><br><span class="line">INACTIVE=-1             是否启用账号过期停权，-1表示不启用，正数代表天数</span><br><span class="line">EXPIRE=                 是否设定到期时间，如果需要，可以设定一个数值，那么用户到期后就不能登录系统</span><br><span class="line">SHELL=/bin/bash         默认的shell</span><br><span class="line">SKEL=/etc/skel          默认配置文件路径，创建账号时此路径下的文件会拷贝到用户的家目录</span><br><span class="line">CREATE_MAIL_SPOOL=yes   是否创建邮件池</span><br></pre></td></tr></table></figure>
<h3 id="5）新用户信息文件：-etc-skel"><a href="#5）新用户信息文件：-etc-skel" class="headerlink" title="5）新用户信息文件：   /etc/skel"></a>5）新用户信息文件：   /etc/skel</h3><p>skel 是skeleton的缩写，每当你新建一个用户的时候（用过useradd命令），/etc/skel目录下的文件，都会原封不动的负值到新建用户的家目录下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -al /etc/skel/</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Feb  6 18:00 .</span><br><span class="line">drwxr-xr-x. 58 root root 4096 Feb  7 09:56 ..</span><br><span class="line">-rw-r--r--.  1 root root   18 Feb 22  2013 .bash_logout</span><br><span class="line">-rw-r--r--.  1 root root  176 Feb 22  2013 .bash_profile</span><br><span class="line">-rw-r--r--.  1 root root  124 Feb 22  2013 .bashrc</span><br></pre></td></tr></table></figure>
<h3 id="6）布告栏信息：-etc-motd"><a href="#6）布告栏信息：-etc-motd" class="headerlink" title="6）布告栏信息：/etc/motd"></a>6）布告栏信息：/etc/motd</h3><p>/etc/motd即messageoftoday（布告栏信息），每次用户登录时，/etc/motd文件的内容会显示在用户的终端。系统管理员可以在文件中编辑系统活动消息，例如：管理员通知用户系统何时进行软件或硬件的升级、何时进行系统维护等。如果shell支持中文，还可以使用中文，这样看起来更易于了解。/etc/motd缺点是，现在许多用户登录系统时选择自动进入图形界面，所以这些信息往往看不到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/issue文件的使用方法与/etc/motd文件相差不大，它们的主要区别在于：当一个网络用户或通过串口登录系统上时，/etc/issue的文件内容显示在login提示符之前，而/etc/motd内容显示在用户成功登录系统之后。</span><br></pre></td></tr></table></figure>
<h2 id="2-创建用户"><a href="#2-创建用户" class="headerlink" title="2. 创建用户"></a>2. 创建用户</h2><h3 id="1）命令"><a href="#1）命令" class="headerlink" title="1）命令"></a>1）命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">useradd         //添加用户</span><br><span class="line">passwd          //为用户设置密码   </span><br><span class="line">userdel         //删除用户</span><br><span class="line">usermod         //修改用户信息</span><br><span class="line">groupadd       //添加用户组</span><br><span class="line">groupdel        //删除用户组</span><br><span class="line">groupmod        //修改用户组信息</span><br><span class="line">groups          //显示当前进程用户所属的用户组</span><br></pre></td></tr></table></figure>
<blockquote>
<p>最简单的创建用户</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# useradd test</span><br><span class="line">[root@localhost ~]# passwd test</span><br><span class="line">Changing password for user test.</span><br><span class="line">New password: </span><br><span class="line">BAD PASSWORD: it is based on a dictionary word</span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br></pre></td></tr></table></figure>
<p>用户名为test，密码为test123。</p>
<blockquote>
<p>查看用户信息</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# id test</span><br><span class="line">uid=500(test) gid=500(test) groups=500(test)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>创建第二个用户test1</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# useradd test1</span><br><span class="line">[root@localhost ~]# passwd test1</span><br><span class="line">Changing password for user test1.</span><br><span class="line">New password: </span><br><span class="line">BAD PASSWORD: it is too simplistic/systematic</span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line"></span><br><span class="line">用户名为test1,密码为abc123,。</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# id test1</span><br><span class="line">uid=501(test1) gid=501(test1) groups=501(test1)</span><br><span class="line"></span><br><span class="line">发现uid和gid递增了1。新建第一个用户时，uid和gid为配置文件中定义的默认最小值。</span><br></pre></td></tr></table></figure>
<blockquote>
<p>带参数的创建用户</p>
<blockquote>
<p>useradd 参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">　-b, --base-dir BASE_DIR       新账户的主目录的基目录</span><br><span class="line">-c, --comment COMMENT         新账户的 GECOS 字段</span><br><span class="line">-d, --home-dir HOME_DIR       新账户的主目录</span><br><span class="line">-D, --defaults                显示或更改默认的 useradd 配置</span><br><span class="line">-e, --expiredate EXPIRE_DATE  新账户的过期日期</span><br><span class="line">-f, --inactive INACTIVE       新账户的密码不活动期</span><br><span class="line">-g, --gid GROUP               新账户主组的名称或 ID</span><br><span class="line">-G, --groups GROUPS   新账户的附加组列表</span><br><span class="line">-h, --help                    显示此帮助信息并推出</span><br><span class="line">-k, --skel SKEL_DIR   使用此目录作为骨架目录</span><br><span class="line">-K, --key KEY=VALUE           不使用 /etc/login.defs 中的默认值</span><br><span class="line">-l, --no-log-init     不要将此用户添加到最近登录和登录失败数据库</span><br><span class="line">-m, --create-home     创建用户的主目录</span><br><span class="line">-M, --no-create-home          不创建用户的主目录</span><br><span class="line">-N, --no-user-group   不创建同名的组</span><br><span class="line">-o, --non-unique              允许使用重复的 UID 创建用户</span><br><span class="line">-p, --password PASSWORD               加密后的新账户密码</span><br><span class="line">-r, --system                  创建一个系统账户</span><br><span class="line">-R, --root CHROOT_DIR         chroot 到的目录</span><br><span class="line">-s, --shell SHELL             新账户的登录 shell</span><br><span class="line">-u, --uid UID                 新账户的用户 ID</span><br><span class="line">-U, --user-group              创建与用户同名的组</span><br><span class="line">-Z, --selinux-user SEUSER             为 SELinux 用户映射使用指定 SEUSER</span><br></pre></td></tr></table></figure></p>
<p>新建一个UID为502，GID位600,30天有效期，用户组为test3，家目录为/home/thirty的用户test2。</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# groupadd -g 600 test3</span><br><span class="line">[root@localhost ~]# useradd -u 501 -g 600 -f 30 -m -d /home/thirty test2</span><br><span class="line">useradd: UID 501 is not unique</span><br><span class="line">[root@localhost ~]# useradd -u 502 -g 600 -f 30 -m -d /home/thirty test2</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# id test2</span><br><span class="line">uid=502(test2) gid=600(test3) groups=600(test3)</span><br><span class="line">[root@localhost ~]# ls /home/</span><br><span class="line">test  test1  thirty</span><br></pre></td></tr></table></figure>
<h2 id="3-更改用户设置"><a href="#3-更改用户设置" class="headerlink" title="3. 更改用户设置"></a>3. 更改用户设置</h2><p>不同的用户需要不同的权限，拥有不同的SHELL，是否允许登录。这个部分，就需要用到usermod命令修改用户配置。</p>
<blockquote>
<p>禁止test1用户登录</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost test1]# usermod -s /sbin/nologin test1</span><br><span class="line">[root@localhost test1]# su test1</span><br><span class="line">This account is currently not available.</span><br><span class="line"></span><br><span class="line">[c:\~]$ ssh 192.168.0.128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Connecting to 192.168.0.128:22...</span><br><span class="line">Connection established.</span><br><span class="line">To escape to local shell, press &apos;Ctrl+Alt+]&apos;.</span><br><span class="line"></span><br><span class="line">Last login: Tue Feb  7 12:31:35 2017 from 192.168.0.1</span><br><span class="line">This account is currently not available.</span><br><span class="line"></span><br><span class="line">Connection closed by foreign host.</span><br><span class="line"></span><br><span class="line">Disconnected from remote host(192.168.0.128:22) at 20:04:08.</span><br><span class="line"></span><br><span class="line">Type `help&apos; to learn how to use Xshell prompt.</span><br><span class="line"></span><br><span class="line">[root@localhost test1]# cat /etc/passwd|grep test1</span><br><span class="line">test1:x:501:501::/home/test1:/sbin/nologin</span><br><span class="line">[root@localhost test1]# cat /etc/shadow |grep test1</span><br><span class="line">test1:$6$PtGopWUu$IEvEngLz3S1Nx6MP0EF60EKzagdbRZhGqSn0vE4JTrra221.G7.8RLBUytHkyNXNPs8SSqm/IfdKolS4SS0Vv/:17204:0:99999:7:::</span><br></pre></td></tr></table></figure>
<blockquote>
<p>修改用户名</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# usermod -l test-1 test1</span><br><span class="line">[root@localhost ~]# cat /etc/passwd|grep test-1</span><br><span class="line">test-1:x:501:501::/home/test1:/sbin/nologin</span><br><span class="line">[root@localhost ~]# cat /etc/shadow |grep test-1</span><br><span class="line">test-1:$6$PtGopWUu$IEvEngLz3S1Nx6MP0EF60EKzagdbRZhGqSn0vE4JTrra221.G7.8RLBUytHkyNXNPs8SSqm/IfdKolS4SS0Vv/:17204:0:99999:7:::</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# usermod </span><br><span class="line">Usage: usermod [options] LOGIN</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -c, --comment COMMENT         new value of the GECOS field</span><br><span class="line">  -d, --home HOME_DIR           new home directory for the user account</span><br><span class="line">  -e, --expiredate EXPIRE_DATE  set account expiration date to EXPIRE_DATE</span><br><span class="line">  -f, --inactive INACTIVE       set password inactive after expiration</span><br><span class="line">                                to INACTIVE</span><br><span class="line">  -g, --gid GROUP               force use GROUP as new primary group</span><br><span class="line">  -G, --groups GROUPS           new list of supplementary GROUPS</span><br><span class="line">  -a, --append                  append the user to the supplemental GROUPS</span><br><span class="line">                                mentioned by the -G option without removing</span><br><span class="line">                                him/her from other groups</span><br><span class="line">  -h, --help                    display this help message and exit</span><br><span class="line">  -l, --login NEW_LOGIN         new value of the login name</span><br><span class="line">  -L, --lock                    lock the user account</span><br><span class="line">  -m, --move-home               move contents of the home directory to the</span><br><span class="line">                                new location (use only with -d)</span><br><span class="line">  -o, --non-unique              allow using duplicate (non-unique) UID</span><br><span class="line">  -p, --password PASSWORD       use encrypted password for the new password</span><br><span class="line">  -s, --shell SHELL             new login shell for the user account</span><br><span class="line">  -u, --uid UID                 new UID for the user account</span><br><span class="line">  -U, --unlock                  unlock the user account</span><br><span class="line">  -Z, --selinux-user            new SELinux user mapping for the user account</span><br></pre></td></tr></table></figure>
<h2 id="4-删除用户-组"><a href="#4-删除用户-组" class="headerlink" title="4. 删除用户/组"></a>4. 删除用户/组</h2><p>当我们创建用户/组有错误时，可能会删除用户/组，然后再重新创建。我们使用userdel命令来删除用户。</p>
<p>执行命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# userdel test</span><br><span class="line">执行完成后，/etc/passwd和/etc/shadow下的test用户信息已经被删除</span><br><span class="line">[root@localhost ~]# ls /home/</span><br><span class="line">test  test1  thirty</span><br><span class="line">但home目录下的用户目录是存在的。</span><br></pre></td></tr></table></figure></p>
<h2 id="5-sudo执行命令"><a href="#5-sudo执行命令" class="headerlink" title="5. sudo执行命令"></a>5. sudo执行命令</h2><p>将当前用户切换到超级用户下，或切换到指定的用户下，然后以超级用户或其指定切换到的用户身份执行命令，执行完成后，直接退回到当前用户。</p>
<p>具体工作过程如下：</p>
<p>当用户执行sudo时，系统会主动寻找/etc/sudoers文件，判断该用户是否有执行sudo的权限</p>
<p>–&gt;确认用户具有可执行sudo的权限后，让用户输入用户自己的密码确认</p>
<p>–&gt;若密码输入成功，则开始执行sudo后续的命令</p>
<blockquote>
<p>基本配置格式</p>
</blockquote>
<p>/etc/sudoer的通用格式：<br>user host run_as command<br>user：一位或几位用户，在/etc/group中可以用一个%代替它，组对象的名称一定要用百分号%开头。<br>host：一个或几个主机名；<br>run_as：作为哪个用户运行，常见的选项是root和ALL<br>cmmand：想让用户或组运行的一个或几个根级别命令</p>
<blockquote>
<p>admin ALL=(ALL) ALL<br>第一个ALL表示所有计算机；第二个ALL表示所有用户；第三个ALL表示所有命令。<br>授权admin用户在所有计算机上以所有用户的身份运行所有命令。</p>
<p>%admin ALL=(ALL) NOPASSWD:NOPASSWD ALL</p>
</blockquote>
<p>admin组的用户都sudo不用密码</p>
<blockquote>
<p>%admin ALL=(ALL) NOPASSWD:useradd,userdel</p>
</blockquote>
<p>授权admin组全部成员在所有计算机上以所有用户的身份运行useradd，userdel命令；且运行时不必输入密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">需要注意的是，当我们为用用户定义可以运行的命令时，必须使用完整的命令路径。</span><br><span class="line">这样做是完全出于安全的考虑，如果我们给出的命令只是简单的useradd而非/usr/sbin/useradd，</span><br><span class="line">那么用户有可能创建一个他自己的脚本，也就做useradd，然后放在它的本地路径中，如此一来他就能够通过这个名为useradd的本地脚本，</span><br><span class="line">作为root来执行任何他想要的命令了。这是相当危险的！</span><br></pre></td></tr></table></figure>
<blockquote>
<p>%account ALL=(root) /usr/sbin/useradd,/usr/sbin/userdel,/usr/sbin/usermod<br>accounts组中的任何成员都能运行useradd、userdel和usermod命令。</p>
<p>jay ALL=NOPASSWD:/usr/bin/abc.sh,/usr/sbin/adduser</p>
</blockquote>
<p>jay用户sudo不用密码即可执行某几个命令</p>
<blockquote>
<p>jay ALL=(ALL) NOPASSWD:ALL</p>
</blockquote>
<p>让普通用户jay 具有所有超级用户的权限而又不用输入密码</p>
</div><div class="post-copyright"><blockquote><p>原文作者: pirogue</p><p>原文链接: <a href="http://pirogue.org/2017/02/08/Linux账户管理/">http://pirogue.org/2017/02/08/Linux账户管理/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/Linux/">Linux</a><a href="/tags/系统/">系统</a><a href="/tags/运维/">运维</a><a href="/tags/账户管理/">账户管理</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2017/02/19/Linux账户审计策略/" class="pre">Linux账户审计策略</a><a href="/2017/02/08/Linux启动服务配置文件的作用和流程/" class="next">Linux启动服务配置文件的作用和流程</a></div><div id="comments"><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="comment"></div><script type="text/javascript">new Valine({
  el: '#comment',  
  notify: false, 
  verify: false, 
  app_id: 'LxlH8totxFLNwkT4nTy2ccay-gzGzoHsz',
  appKey: 'Pzf3CsqHnjhKJryLexrAy45U',
  // 评论框占位符
  placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',  
  // 当前文章页路径，用于区分不同的文章页，以保证正确读取该文章页下的评论列表
  path:window.location.pathname,  
  // 默认头像类型
  avatar: 'wavatar',
  // 每页展示评论条数
  pageSize: 15
});</script></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-用户信息与密码的配置文件"><span class="toc-text">1. 用户信息与密码的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-用户信息文件：-etc-passwd"><span class="toc-text">1) 用户信息文件：     /etc/passwd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2）密码文件：-etc-shadow"><span class="toc-text">2）密码文件：         /etc/shadow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3）用户组文件：-etc-group"><span class="toc-text">3）用户组文件：       /etc/group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4）用户组密码文件：-etc-gshadow"><span class="toc-text">4）用户组密码文件：   /etc/gshadow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5）用户配置文件：-etc-login-defs、-etc-default-useradd"><span class="toc-text">5）用户配置文件：/etc/login.defs、/etc/default/useradd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5）新用户信息文件：-etc-skel"><span class="toc-text">5）新用户信息文件：   /etc/skel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6）布告栏信息：-etc-motd"><span class="toc-text">6）布告栏信息：/etc/motd</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-创建用户"><span class="toc-text">2. 创建用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1）命令"><span class="toc-text">1）命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-更改用户设置"><span class="toc-text">3. 更改用户设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-删除用户-组"><span class="toc-text">4. 删除用户/组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-sudo执行命令"><span class="toc-text">5. sudo执行命令</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/12/14/bacscanner/">越权扫描器碎碎念</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/24/quant/">币圈量化交易试水</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/22/golangxml/">被动扫描器研发（1）：golang生成cdata xml格式数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/17/awvs/">awvs（12.0.190515149）linux 安装和破解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/opencanary_2/">opencanary二次开发(1)-日志格式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/09/opencanary_1/">蜜罐正式开源-简单易用-支持16种协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/17/SPA/">前后端分离开发风险浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/14/异地恋/">异地恋</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/26/phishing/">甲方企业安全建设之钓鱼实践的一种姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/20/yulong-hids/">驭龙hids入侵检测功能初探</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/安全建设/">安全建设</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全开发/">安全开发</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全运维/">安全运维</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作生活/">工作生活</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/">渗透测试</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/诗和远方/">诗和远方</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化交易/">量化交易</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Phishing/" style="font-size: 15px;">Phishing</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/运维/" style="font-size: 15px;">运维</a> <a href="/tags/审计策略/" style="font-size: 15px;">审计策略</a> <a href="/tags/安全建设/" style="font-size: 15px;">安全建设</a> <a href="/tags/甲方安全/" style="font-size: 15px;">甲方安全</a> <a href="/tags/前后端分离/" style="font-size: 15px;">前后端分离</a> <a href="/tags/开发/" style="font-size: 15px;">开发</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/渗透测试/" style="font-size: 15px;">渗透测试</a> <a href="/tags/文件上传漏洞/" style="font-size: 15px;">文件上传漏洞</a> <a href="/tags/阿里云OSS/" style="font-size: 15px;">阿里云OSS</a> <a href="/tags/awvs/" style="font-size: 15px;">awvs</a> <a href="/tags/漏洞扫描器/" style="font-size: 15px;">漏洞扫描器</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/回调函数/" style="font-size: 15px;">回调函数</a> <a href="/tags/脏牛/" style="font-size: 15px;">脏牛</a> <a href="/tags/dirtycow/" style="font-size: 15px;">dirtycow</a> <a href="/tags/CVE-2016-5195/" style="font-size: 15px;">CVE-2016-5195</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/留言板/" style="font-size: 15px;">留言板</a> <a href="/tags/CVE-2017-7525/" style="font-size: 15px;">CVE-2017-7525</a> <a href="/tags/CVE-2017-17485/" style="font-size: 15px;">CVE-2017-17485</a> <a href="/tags/Jackson-databind反序列化漏洞/" style="font-size: 15px;">Jackson-databind反序列化漏洞</a> <a href="/tags/安全分析/" style="font-size: 15px;">安全分析</a> <a href="/tags/蜜罐/" style="font-size: 15px;">蜜罐</a> <a href="/tags/开源/" style="font-size: 15px;">开源</a> <a href="/tags/opencanary/" style="font-size: 15px;">opencanary</a> <a href="/tags/OSS对象存储/" style="font-size: 15px;">OSS对象存储</a> <a href="/tags/上传漏洞/" style="font-size: 15px;">上传漏洞</a> <a href="/tags/解析漏洞/" style="font-size: 15px;">解析漏洞</a> <a href="/tags/漏洞预警/" style="font-size: 15px;">漏洞预警</a> <a href="/tags/截屏/" style="font-size: 15px;">截屏</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/信息安全/" style="font-size: 15px;">信息安全</a> <a href="/tags/黑客/" style="font-size: 15px;">黑客</a> <a href="/tags/信息收集/" style="font-size: 15px;">信息收集</a> <a href="/tags/系统/" style="font-size: 15px;">系统</a> <a href="/tags/钓鱼/" style="font-size: 15px;">钓鱼</a> <a href="/tags/poster模块/" style="font-size: 15px;">poster模块</a> <a href="/tags/上传/" style="font-size: 15px;">上传</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/QQ邮箱/" style="font-size: 15px;">QQ邮箱</a> <a href="/tags/ssrf/" style="font-size: 15px;">ssrf</a> <a href="/tags/w3af/" style="font-size: 15px;">w3af</a> <a href="/tags/诗歌/" style="font-size: 15px;">诗歌</a> <a href="/tags/配置文件/" style="font-size: 15px;">配置文件</a> <a href="/tags/xml/" style="font-size: 15px;">xml</a> <a href="/tags/cdata/" style="font-size: 15px;">cdata</a> <a href="/tags/burpsuite/" style="font-size: 15px;">burpsuite</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/二次开发/" style="font-size: 15px;">二次开发</a> <a href="/tags/btc/" style="font-size: 15px;">btc</a> <a href="/tags/量化交易/" style="font-size: 15px;">量化交易</a> <a href="/tags/CVE-2017-10271/" style="font-size: 15px;">CVE-2017-10271</a> <a href="/tags/java反序列化/" style="font-size: 15px;">java反序列化</a> <a href="/tags/weblogic反序列化漏洞/" style="font-size: 15px;">weblogic反序列化漏洞</a> <a href="/tags/XMLDecoder反序列化漏洞/" style="font-size: 15px;">XMLDecoder反序列化漏洞</a> <a href="/tags/工作生活/" style="font-size: 15px;">工作生活</a> <a href="/tags/乙方安全/" style="font-size: 15px;">乙方安全</a> <a href="/tags/启动流程/" style="font-size: 15px;">启动流程</a> <a href="/tags/账户管理/" style="font-size: 15px;">账户管理</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/Web自动化攻击平台/" style="font-size: 15px;">Web自动化攻击平台</a> <a href="/tags/Apache-Commons-Collections/" style="font-size: 15px;">Apache Commons Collections</a> <a href="/tags/反弹shell/" style="font-size: 15px;">反弹shell</a> <a href="/tags/安全监控/" style="font-size: 15px;">安全监控</a> <a href="/tags/exp/" style="font-size: 15px;">exp</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/网络安全/" style="font-size: 15px;">网络安全</a> <a href="/tags/hids/" style="font-size: 15px;">hids</a> <a href="/tags/驭龙hids/" style="font-size: 15px;">驭龙hids</a> <a href="/tags/安全开发/" style="font-size: 15px;">安全开发</a> <a href="/tags/越权/" style="font-size: 15px;">越权</a> <a href="/tags/扫描器/" style="font-size: 15px;">扫描器</a> <a href="/tags/Wazuh/" style="font-size: 15px;">Wazuh</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">20</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.0x001.com/" title="0x001" target="_blank">0x001</a><ul></ul><a href="http://ksowo.com/" title="lyy" target="_blank">lyy</a><ul></ul><a href="http://xxlegend.com/" title="xxlegend" target="_blank">xxlegend</a><ul></ul><a href="https://bl4ck.in/" title="Tomato" target="_blank">Tomato</a><ul></ul><a href="https://my.oschina.net/9199771" title="超级大黑猫" target="_blank">超级大黑猫</a><ul></ul><a href="https://www.weiho.xyz/" title="Weiho" target="_blank">Weiho</a><ul></ul><a href="https://www.maliciouskr.cc/" title="MaliciousKr" target="_blank">MaliciousKr</a><ul></ul><a href="http://www.lshack.cn/" title="lsh4ck's blog" target="_blank">lsh4ck's blog</a><ul></ul><a href="https://www.0x002.com" title="Yunen's blog" target="_blank">Yunen's blog</a><ul></ul><a href="https://www.dp2px.com/" title="水寒的博客" target="_blank">水寒的博客</a><ul></ul><a href="https://www.pa55w0rd.online/" title="Pa55w0rd's blog" target="_blank">Pa55w0rd's blog</a><ul></ul><a href="http://www.mianhuage.com/" title="Cotton's Blog" target="_blank">Cotton's Blog</a><ul></ul><a href="https://zgao.top/" title="zgao" target="_blank">zgao</a><ul></ul><a href="http://lab.orchina.org/" title="糖果的实验室" target="_blank">糖果的实验室</a><ul></ul><a href="https://www.ms17010.net/" title="yd" target="_blank">yd</a><ul></ul><a href="http://blog.leanote.com/snowming" title="snowming" target="_blank">snowming</a><ul></ul><a href="https://www.cnblogs.com/ssooking" title="ssooking" target="_blank">ssooking</a><br>
<br>
『将定期清理无法访问的友情链接』</div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">pirogue.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-92976027-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>