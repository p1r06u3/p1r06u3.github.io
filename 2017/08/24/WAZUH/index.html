<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="一个信息安全从业者的博客"><meta name="keywords" content="信息安全, 网络安全, 黑客, 渗透测试, Linux安全运维, 安全开发, python"><title>Wazuh搭建 | pirogue</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Wazuh搭建</h1><a id="logo" href="/.">pirogue</a><p class="description">你曾听过一个地方，到达之时我们将拥有一切吗？</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Wazuh搭建</h1><div class="post-meta"><a href="/2017/08/24/WAZUH/#comments" class="comment-count"></a><p><span class="date">Aug 24, 2017</span><span><a href="/categories/安全建设/" class="category">安全建设</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h2 id="WAZUH架构图"><a href="#WAZUH架构图" class="headerlink" title="WAZUH架构图"></a>WAZUH架构图</h2><h3 id="分布式"><a href="#分布式" class="headerlink" title="分布式"></a>分布式</h3><p><img src="/2017/08/24/WAZUH/distributed.jpg" alt="wazuh_distributed"></p>
<h3 id="单台部署"><a href="#单台部署" class="headerlink" title="单台部署"></a>单台部署</h3><p><img src="/2017/08/24/WAZUH/single.jpg" alt="wazuh_single"></p>
<h2 id="Install-Wazuh-server"><a href="#Install-Wazuh-server" class="headerlink" title="Install Wazuh server"></a>Install Wazuh server</h2><h3 id="添加CentOS-wazuh源"><a href="#添加CentOS-wazuh源" class="headerlink" title="添加CentOS wazuh源"></a>添加CentOS wazuh源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; /etc/yum.repos.d/wazuh.repo &lt;&lt;\EOF</span><br><span class="line">[wazuh_repo]</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH</span><br><span class="line">enabled=1</span><br><span class="line">name=CentOS-$releasever - Wazuh</span><br><span class="line">baseurl=https://packages.wazuh.com/yum/el/$releasever/$basearch</span><br><span class="line">protect=1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="安装Wazuh-manager"><a href="#安装Wazuh-manager" class="headerlink" title="安装Wazuh-manager"></a>安装Wazuh-manager</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install wazuh-manager</span><br></pre></td></tr></table></figure>
<ul>
<li>查看Wazuh运行状态<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost init.d]# service wazuh-manager status</span><br><span class="line">ossec-monitord is running...</span><br><span class="line">ossec-logcollector is running...</span><br><span class="line">ossec-remoted is running...</span><br><span class="line">ossec-syscheckd is running...</span><br><span class="line">ossec-analysisd is running...</span><br><span class="line">ossec-maild not running...</span><br><span class="line">ossec-execd is running...</span><br><span class="line">wazuh-modulesd is running...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="安装Wazuh-API"><a href="#安装Wazuh-API" class="headerlink" title="安装Wazuh API"></a>安装Wazuh API</h3><ul>
<li>安装NodeJS</li>
</ul>
<blockquote>
<p>[root@localhost opt]# curl –silent –location <a href="https://rpm.nodesource.com/setup_6.x" target="_blank" rel="noopener">https://rpm.nodesource.com/setup_6.x</a> | bash -</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">## Installing the NodeSource Node.js 6.x repo...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## Inspecting system...</span><br><span class="line"></span><br><span class="line">+ rpm -q --whatprovides redhat-release || rpm -q --whatprovides centos-release || rpm -q --whatprovides cloudlinux-release || rpm -q --whatprovides sl-release</span><br><span class="line">+ uname -m</span><br><span class="line"></span><br><span class="line">## Confirming &quot;el6-x86_64&quot; is supported...</span><br><span class="line"></span><br><span class="line">+ curl -sLf -o /dev/null &apos;https://rpm.nodesource.com/pub_6.x/el/6/x86_64/nodesource-release-el6-1.noarch.rpm&apos;</span><br><span class="line"></span><br><span class="line">## Downloading release setup RPM...</span><br><span class="line"></span><br><span class="line">+ mktemp</span><br><span class="line">+ curl -sL -o &apos;/tmp/tmp.l3Z6OzvS3W&apos; &apos;https://rpm.nodesource.com/pub_6.x/el/6/x86_64/nodesource-release-el6-1.noarch.rpm&apos;</span><br><span class="line"></span><br><span class="line">## Installing release setup RPM...</span><br><span class="line"></span><br><span class="line">+ rpm -i --nosignature --force &apos;/tmp/tmp.l3Z6OzvS3W&apos;</span><br><span class="line"></span><br><span class="line">## Cleaning up...</span><br><span class="line"></span><br><span class="line">+ rm -f &apos;/tmp/tmp.l3Z6OzvS3W&apos;</span><br><span class="line"></span><br><span class="line">## Checking for existing installations...</span><br><span class="line"></span><br><span class="line">+ rpm -qa &apos;node|npm&apos; | grep -v nodesource</span><br><span class="line"></span><br><span class="line">## Run `yum install -y nodejs` (as root) to install Node.js 6.x and npm.</span><br><span class="line">## You may also need development tools to build native addons:</span><br><span class="line">##   `yum install -y gcc-c++ make`</span><br></pre></td></tr></table></figure>
<blockquote>
<p>[root@localhost opt]# ls</p>
<p>[root@localhost opt]# yum install nodejs</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">nodesource                                                                                                                         | 2.5 kB     00:00     </span><br><span class="line">nodesource/primary_db                                                                                                              |  43 kB     00:00     </span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package nodejs.x86_64 2:6.11.1-1nodesource.el6 will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">==========================================================================================================================================================</span><br><span class="line"> 软件包                         架构                           版本                                              仓库                                大小</span><br><span class="line">==========================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> nodejs                         x86_64                         2:6.11.1-1nodesource.el6                          nodesource                         9.5 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">==========================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：9.5 M</span><br><span class="line">Installed size: 33 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">nodejs-6.11.1-1nodesource.el6.x86_64.rpm                                                                                           | 9.5 MB     00:20     </span><br><span class="line">warning: rpmts_HdrFromFdno: Header V4 RSA/SHA1 Signature, key ID 34fa74dd: NOKEY</span><br><span class="line">Retrieving key from file:///etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL</span><br><span class="line">Importing GPG key 0x34FA74DD:</span><br><span class="line"> Userid : NodeSource &lt;gpg-rpm@nodesource.com&gt;</span><br><span class="line"> Package: nodesource-release-el6-1.noarch (installed)</span><br><span class="line"> From   : /etc/pki/rpm-gpg/NODESOURCE-GPG-SIGNING-KEY-EL</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">Warning: RPMDB altered outside of yum.</span><br><span class="line">  正在安装   : 2:nodejs-6.11.1-1nodesource.el6.x86_64                                                                                                 1/1 </span><br><span class="line">  Verifying  : 2:nodejs-6.11.1-1nodesource.el6.x86_64                                                                                                 1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  nodejs.x86_64 2:6.11.1-1nodesource.el6                                                                                                                  </span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>
<ul>
<li>安装Wazuh API</li>
</ul>
<blockquote>
<p>[root@localhost opt]# yum install wazuh-api</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package wazuh-api.x86_64 0:2.0.1-1.el6 will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">==========================================================================================================================================================</span><br><span class="line"> 软件包                              架构                             版本                                     仓库                                  大小</span><br><span class="line">==========================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> wazuh-api                           x86_64                           2.0.1-1.el6                              wazuh_repo                           2.0 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">==========================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：2.0 M</span><br><span class="line">Installed size: 7.8 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">wazuh-api-2.0.1-1.el6.x86_64.rpm                                                                                                   | 2.0 MB     00:04     </span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在安装   : wazuh-api-2.0.1-1.el6.x86_64                                                                                                           1/1 </span><br><span class="line">Installing for SysVinit</span><br><span class="line">WAZUH-API is not running.</span><br><span class="line">WAZUH-API started.</span><br><span class="line">Don&apos;t forget to run the configuration script after installation: /var/ossec/api/scripts/configure_api.sh</span><br><span class="line">Warning: Minimal supported version is 2.7</span><br><span class="line">root     21160  5.0  0.2 614120  7952 pts/0    Rl+  15:12   0:00 /usr/bin/node /var/ossec/api/app.js</span><br><span class="line">WAZUH-API stopped.</span><br><span class="line">WAZUH-API started.</span><br><span class="line">  Verifying  : wazuh-api-2.0.1-1.el6.x86_64                                                                                                           1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  wazuh-api.x86_64 0:2.0.1-1.el6                                                                                                                          </span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>
<ul>
<li>wazuh-api状态错误</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Python-2.7.3]# service wazuh-api status</span><br><span class="line">WAZUH-API is stopped.</span><br><span class="line"></span><br><span class="line">Last 20 log entries:</span><br><span class="line">WazuhAPI 2017-08-01 15:12:23: ERROR: No suitable Python version found. This application requires Python 2.7 or newer. Exiting.</span><br><span class="line"></span><br><span class="line">Full log: /var/ossec/logs/api.log</span><br></pre></td></tr></table></figure>
<ul>
<li>Cent0S 6安装python27</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y centos-release-scl</span><br><span class="line">$ yum install -y python27</span><br></pre></td></tr></table></figure>
<ul>
<li>查看wazuh-api状态</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Python-2.7.3]# service wazuh-api start</span><br><span class="line">WAZUH-API started.</span><br><span class="line">[root@localhost Python-2.7.3]# service wazuh-api status</span><br><span class="line">WAZUH-API is running.</span><br></pre></td></tr></table></figure>
<h3 id="安装-Filebeat"><a href="#安装-Filebeat" class="headerlink" title="安装 Filebeat"></a>安装 Filebeat</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">[root@localhost opt]# cat &gt; /etc/yum.repos.d/elastic.repo &lt;&lt; EOF</span><br><span class="line">&gt; [elastic-5.x]</span><br><span class="line">&gt; name=Elastic repository for 5.x packages</span><br><span class="line">&gt; baseurl=https://artifacts.elastic.co/packages/5.x/yum</span><br><span class="line">&gt; gpgcheck=1</span><br><span class="line">&gt; gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">&gt; enabled=1</span><br><span class="line">&gt; autorefresh=1</span><br><span class="line">&gt; type=rpm-md</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>
<blockquote>
<p>[root@localhost opt]# yum install filebeat</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">elastic-5.x                                                                                                                        | 1.3 kB     00:00     </span><br><span class="line">elastic-5.x/primary                                                                                                                |  81 kB     00:00     </span><br><span class="line">elastic-5.x                                                                                                                                       206/206</span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package filebeat.x86_64 0:5.5.1-1 will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">==========================================================================================================================================================</span><br><span class="line"> 软件包                              架构                              版本                                  仓库                                    大小</span><br><span class="line">==========================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> filebeat                            x86_64                            5.5.1-1                               elastic-5.x                            8.7 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">==========================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：8.7 M</span><br><span class="line">Installed size: 29 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">filebeat-5.5.1-x86_64.rpm                                                                                                          | 8.7 MB     06:35     </span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在安装   : filebeat-5.5.1-1.x86_64                                                                                                                1/1 </span><br><span class="line">  Verifying  : filebeat-5.5.1-1.x86_64                                                                                                                1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  filebeat.x86_64 0:5.5.1-1                                                                                                                               </span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>
<ul>
<li>下载Filebeat配置文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# curl -so /etc/filebeat/filebeat.yml https://raw.githubusercontent.com/wazuh/wazuh/2.0/extensions/filebeat/filebeat.yml</span><br><span class="line">[root@localhost opt]# ls /etc/file</span><br><span class="line">filebeat/    filesystems  </span><br><span class="line">[root@localhost opt]# ls /etc/filebeat/filebeat.</span><br><span class="line">filebeat.full.yml            filebeat.template-es2x.json  filebeat.template-es6x.json  filebeat.template.json       filebeat.yml</span><br><span class="line">[root@localhost opt]# ls /etc/filebeat/filebeat.</span><br><span class="line">filebeat.full.yml            filebeat.template-es2x.json  filebeat.template-es6x.json  filebeat.template.json       filebeat.yml</span><br><span class="line">[root@localhost opt]# ls /etc/filebeat/filebeat.yml </span><br><span class="line">/etc/filebeat/filebeat.yml</span><br><span class="line">[root@localhost opt]# cat /etc/filebeat/filebeat.yml </span><br><span class="line">filebeat:</span><br><span class="line"> prospectors:</span><br><span class="line">  - input_type: log</span><br><span class="line">    paths:</span><br><span class="line">     - &quot;/var/ossec/logs/alerts/alerts.json&quot;</span><br><span class="line">    document_type: json</span><br><span class="line">    json.message_key: log</span><br><span class="line">    json.keys_under_root: true</span><br><span class="line">    json.overwrite_keys: true</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line"> logstash:</span><br><span class="line">   # The Logstash hosts</span><br><span class="line">   hosts: [&quot;YOUR_ELASTIC_SERVER_IP:5000&quot;]</span><br><span class="line">#   ssl:</span><br><span class="line">#     certificate_authorities: [&quot;/etc/filebeat/logstash.crt&quot;]</span><br></pre></td></tr></table></figure>
<ul>
<li>修改elastic_server_ip</li>
</ul>
<blockquote>
<p>[root@localhost opt]# vi /etc/filebeat/filebeat.yml</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">filebeat:</span><br><span class="line"> prospectors:</span><br><span class="line">  - input_type: log</span><br><span class="line">    paths:</span><br><span class="line">     - &quot;/var/ossec/logs/alerts/alerts.json&quot;</span><br><span class="line">    document_type: json</span><br><span class="line">    json.message_key: log</span><br><span class="line">    json.keys_under_root: true</span><br><span class="line">    json.overwrite_keys: true</span><br><span class="line"></span><br><span class="line">output:</span><br><span class="line"> logstash:</span><br><span class="line">   # The Logstash hosts</span><br><span class="line">   hosts: [&quot;192.168.1.43:5000&quot;]</span><br><span class="line">#   ssl:</span><br><span class="line">#     certificate_authorities: [&quot;/etc/filebeat/logstash.crt&quot;]</span><br></pre></td></tr></table></figure>
<ul>
<li>添加Filebeat服务并启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# chkconfig --add filebeat</span><br><span class="line">[root@localhost opt]# service filebeat start</span><br><span class="line">Starting filebeat: 2017/08/01 10:06:00.996092 beat.go:285: INFO Home path: [/usr/share/filebeat] Config path: [/etc/filebeat] Data path: [/var/lib/filebeat] Logs path: [/var/log/filebeat]</span><br><span class="line">2017/08/01 10:06:00.996210 beat.go:186: INFO Setup Beat: filebeat; Version: 5.5.1</span><br><span class="line">2017/08/01 10:06:00.996254 metrics.go:23: INFO Metrics logging every 30s</span><br><span class="line">2017/08/01 10:06:00.996500 logstash.go:90: INFO Max Retries set to: 3</span><br><span class="line">2017/08/01 10:06:00.996763 outputs.go:108: INFO Activated logstash as output plugin.</span><br><span class="line">2017/08/01 10:06:00.997506 publish.go:295: INFO Publisher name: localhost.localdomain</span><br><span class="line">2017/08/01 10:06:01.008432 async.go:63: INFO Flush Interval set to: 1s</span><br><span class="line">2017/08/01 10:06:01.008471 async.go:64: INFO Max Bulk Size set to: 2048</span><br><span class="line">Config OK</span><br><span class="line">                                                           [确定]</span><br></pre></td></tr></table></figure>
<h2 id="Install-Elastic-Stack"><a href="#Install-Elastic-Stack" class="headerlink" title="Install Elastic Stack"></a>Install Elastic Stack</h2><h3 id="安装-Java-JRE-Logstash和Elasticsearch必要的依赖"><a href="#安装-Java-JRE-Logstash和Elasticsearch必要的依赖" class="headerlink" title="安装 Java JRE (Logstash和Elasticsearch必要的依赖)"></a>安装 Java JRE (Logstash和Elasticsearch必要的依赖)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /opt/</span><br><span class="line">[root@localhost opt]# ls</span><br><span class="line">[root@localhost opt]# curl -Lo jre-8-linux-x64.rpm --header &quot;Cookie: oraclelicense=accept-securebackup-cookie&quot; &quot;http://download.oracle.com/otn-pub/java/jdk/8u144-b01/090f390dda5b47b9b721c7dfaa008135/jre-8u144-linux-x64.rpm&quot;</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 56.4M  100 56.4M    0     0  20.1M      0  0:00:02  0:00:02 --:--:-- 23.3M</span><br><span class="line">[root@localhost opt]# ll</span><br><span class="line">总用量 57832</span><br><span class="line">-rw-r--r--. 1 root root 59219102 8月  22 14:45 jre-8-linux-x64.rpm</span><br><span class="line">[root@localhost opt]# rpm -qlp jre-8-linux-x64.rpm &gt; /dev/null 2&gt;&amp;1 &amp;&amp; echo &quot;Java package downloaded successfully&quot; || echo &quot;Java package did not download successfully&quot;</span><br><span class="line">Java package downloaded successfully</span><br><span class="line">[root@localhost opt]# yum install jre-8-linux-x64.rpm</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">诊断 jre-8-linux-x64.rpm: jre1.8.0_144-1.8.0_144-fcs.x86_64</span><br><span class="line">jre-8-linux-x64.rpm 将被安装</span><br><span class="line">base                                                                                                                     | 3.7 kB     00:00     </span><br><span class="line">base/primary_db                                                                                                          | 4.7 MB     00:00     </span><br><span class="line">extras                                                                                                                   | 3.4 kB     00:00     </span><br><span class="line">extras/primary_db                                                                                                        |  29 kB     00:01     </span><br><span class="line">updates                                                                                                                  | 3.4 kB     00:00     </span><br><span class="line">updates/primary_db                                                                                                       | 2.5 MB     00:05     </span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package jre1.8.0_144.x86_64 0:1.8.0_144-fcs will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> 软件包                            架构                        版本                                 仓库                                   大小</span><br><span class="line">================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> jre1.8.0_144                      x86_64                      1.8.0_144-fcs                        /jre-8-linux-x64                      133 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总文件大小：133 M</span><br><span class="line">Installed size: 133 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在安装   : jre1.8.0_144-1.8.0_144-fcs.x86_64                                                                                            1/1 </span><br><span class="line">Unpacking JAR files...</span><br><span class="line">  plugin.jar...</span><br><span class="line">  javaws.jar...</span><br><span class="line">  deploy.jar...</span><br><span class="line">  rt.jar...</span><br><span class="line">  jsse.jar...</span><br><span class="line">  charsets.jar...</span><br><span class="line">  localedata.jar...</span><br><span class="line">  Verifying  : jre1.8.0_144-1.8.0_144-fcs.x86_64                                                                                            1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  jre1.8.0_144.x86_64 0:1.8.0_144-fcs                                                                                                           </span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line">[root@localhost opt]# rm jre-8-linux-x64.rpm</span><br><span class="line">rm：是否删除普通文件 &quot;jre-8-linux-x64.rpm&quot;？y</span><br><span class="line">[root@localhost opt]# ls</span><br><span class="line">[root@localhost opt]# rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">[root@localhost opt]# ls</span><br><span class="line">[root@localhost opt]# cat &gt; /etc/yum.repos.d/elastic.repo &lt;&lt; EOF</span><br><span class="line">&gt; [elastic-5.x]</span><br><span class="line">&gt; name=Elastic repository for 5.x packages</span><br><span class="line">&gt; baseurl=https://artifacts.elastic.co/packages/5.x/yum</span><br><span class="line">&gt; gpgcheck=1</span><br><span class="line">&gt; gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch</span><br><span class="line">&gt; enabled=1</span><br><span class="line">&gt; autorefresh=1</span><br><span class="line">&gt; type=rpm-md</span><br><span class="line">&gt; EOF</span><br></pre></td></tr></table></figure>
<h3 id="安装elasticsearch"><a href="#安装elasticsearch" class="headerlink" title="安装elasticsearch"></a>安装elasticsearch</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# yum install elasticsearch</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Determining fastest mirrors</span><br><span class="line"> * base: mirrors.btte.net</span><br><span class="line"> * extras: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * updates: mirror.bit.edu.cn</span><br><span class="line">elastic-5.x                                                                                                              | 1.3 kB     00:00     </span><br><span class="line">elastic-5.x/primary                                                                                                      |  86 kB     00:00     </span><br><span class="line">elastic-5.x                                                                                                                             218/218</span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package elasticsearch.noarch 0:5.5.2-1 will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> 软件包                                架构                           版本                            仓库                                 大小</span><br><span class="line">================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> elasticsearch                         noarch                         5.5.2-1                         elastic-5.x                          32 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：32 M</span><br><span class="line">Installed size: 36 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">elasticsearch-5.5.2.rpm                                                                                                  |  32 MB     09:03     </span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">Creating elasticsearch group... OK</span><br><span class="line">Creating elasticsearch user... OK</span><br><span class="line">  正在安装   : elasticsearch-5.5.2-1.noarch                                                                                                 1/1 </span><br><span class="line">### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using chkconfig</span><br><span class="line"> sudo chkconfig --add elasticsearch</span><br><span class="line">### You can start elasticsearch service by executing</span><br><span class="line"> sudo service elasticsearch start</span><br><span class="line">  Verifying  : elasticsearch-5.5.2-1.noarch                                                                                                 1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  elasticsearch.noarch 0:5.5.2-1                                                                                                                </span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line">[root@localhost opt]# chkconfig --add elasticsearch</span><br><span class="line">[root@localhost opt]# service elasticsearch start</span><br><span class="line">正在启动 elasticsearch：                                   [确定]</span><br><span class="line">[root@localhost opt]# curl https://raw.githubusercontent.com/wazuh/wazuh-kibana-app/master/server/startup/integration_files/template_file.json | curl -XPUT &apos;http://localhost:9200/_template/wazuh&apos; -H &apos;Content-Type: application/json&apos; -d @-</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 15547  100 15547    0     0  16125      0 --:--:-- --:--:-- --:--:-- 40592</span><br><span class="line">&#123;&quot;acknowledged&quot;:true&#125;[root@localhost opt]# ls</span><br><span class="line">[root@localhost opt]# ls</span><br><span class="line">[root@localhost opt]# curl https://raw.githubusercontent.com/wazuh/wazuh-kibana-app/master/server/startup/integration_files/alert_sample.json | curl -XPUT &quot;http://localhost:9200/wazuh-alerts-&quot;`date +%Y.%m.%d`&quot;/wazuh/sample&quot; -H &apos;Content-Type: application/json&apos; -d @-</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">102  1432  102  1432    0     0   1567      0 --:--:-- --:--:-- --:--:--  4937</span><br><span class="line">&#123;&quot;_index&quot;:&quot;wazuh-alerts-2017.08.22&quot;,&quot;_type&quot;:&quot;wazuh&quot;,&quot;_id&quot;:&quot;sample&quot;,&quot;_version&quot;:1,&quot;result&quot;:&quot;created&quot;,&quot;_shards&quot;:&#123;&quot;total&quot;:2,&quot;successful&quot;:1,&quot;failed&quot;:0&#125;,&quot;created&quot;:true&#125;[root@localhost opt]# </span><br><span class="line">[root@localhost opt]#</span><br></pre></td></tr></table></figure>
<blockquote>
<p>It is recommended to edit the default configuration to improve the Elasticsearch performance. To do so, please see Elasticsearch tuning.<a href="https://documentation.wazuh.com/current/installation-guide/optional-configurations/elastic-tuning.html#elastic-tuning" target="_blank" rel="noopener">https://documentation.wazuh.com/current/installation-guide/optional-configurations/elastic-tuning.html#elastic-tuning</a></p>
</blockquote>
<h3 id="安装Logstash"><a href="#安装Logstash" class="headerlink" title="安装Logstash"></a>安装Logstash</h3><blockquote>
<p>Logstash is the tool that will collect, parse, and forward to Elasticsearch for indexing and storage all logs generated by Wazuh server. For more info please see Logstash.<a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener">https://www.elastic.co/products/logstash</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# yum install logstash</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.btte.net</span><br><span class="line"> * extras: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * updates: mirror.bit.edu.cn</span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package logstash.noarch 1:5.5.2-1 will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> 软件包                           架构                           版本                                 仓库                                 大小</span><br><span class="line">================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> logstash                         noarch                         1:5.5.2-1                            elastic-5.x                          90 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：90 M</span><br><span class="line">Installed size: 169 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">logstash-5.5.2.rpm                                                                                                       |  90 MB     33:26     </span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在安装   : 1:logstash-5.5.2-1.noarch                                                                                                    1/1 </span><br><span class="line">Using provided startup.options file: /etc/logstash/startup.options</span><br><span class="line">Successfully created system startup script for Logstash</span><br><span class="line">  Verifying  : 1:logstash-5.5.2-1.noarch                                                                                                    1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  logstash.noarch 1:5.5.2-1                                                                                                                     </span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line">[root@localhost opt]# curl -so /etc/logstash/conf.d/01-wazuh.conf https://raw.githubusercontent.com/wazuh/wazuh/2.0/extensions/logstash/01-wazuh.conf</span><br><span class="line">[root@localhost opt]# curl -so /etc/logstash/wazuh-elastic5-template.json https://raw.githubusercontent.com/wazuh/wazuh/2.0/extensions/elasticsearch/wazuh-elastic5-template.json</span><br><span class="line">[root@localhost opt]# /usr/share/logstash/bin/system-install </span><br><span class="line">Successfully created system startup script for Logstash</span><br><span class="line">[root@localhost opt]# chkconfig --add logstash</span><br><span class="line">在 logstash 服务中读取信息时出错：没有那个文件或目录</span><br><span class="line">[root@localhost opt]# ls /etc/init.d/</span><br><span class="line">auditd         functions      iptables       killall        netconsole     postfix        rsyslog        single         </span><br><span class="line">crond          halt           jexec          mdmonitor      netfs          rdisc          sandbox        sshd           </span><br><span class="line">elasticsearch  ip6tables      kdump          messagebus     network        restorecond    saslauthd      udev-post      </span><br><span class="line">[root@localhost opt]# /usr/share/logstash/bin/system-install /etc/logstash/startup.options sysv</span><br><span class="line">Using provided startup.options file: /etc/logstash/startup.options</span><br><span class="line">Manually creating startup for specified platform: sysv</span><br><span class="line">Successfully created system startup script for Logstash</span><br><span class="line">[root@localhost opt]# chkconfig --add logstash</span><br><span class="line">[root@localhost opt]# service logstash start</span><br><span class="line">logstash started</span><br></pre></td></tr></table></figure>
<h3 id="Setting-up-SSL-for-Filebeat-and-Logstash"><a href="#Setting-up-SSL-for-Filebeat-and-Logstash" class="headerlink" title="Setting up SSL for Filebeat and Logstash"></a>Setting up SSL for Filebeat and Logstash</h3><blockquote>
<p>因为Wazuh server和Elastic Stack server是分布式架构，要配置在Filebeat和Logstash之间配SSL加密。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# cp /etc/pki/tls/openssl.cnf custom_openssl.cnf</span><br></pre></td></tr></table></figure>
<p>vi custom_openssl.cnf<br>找到[ v3_ca ]字段，然后在它下面添加一行elastic server的ip地址：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ v3_ca ]</span><br><span class="line">subjectAltName = IP: 192.168.106.43</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# openssl req -x509 -batch -nodes -days 3650 -newkey rsa:2048 -keyout /etc/logstash/logstash.key -out /etc/logstash/logstash.crt -config custom_openssl.cnf</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">.................+++</span><br><span class="line">.....+++</span><br><span class="line">writing new private key to &apos;/etc/logstash/logstash.key&apos;</span><br><span class="line">-----</span><br><span class="line">[root@localhost opt]# rm custom_openssl.cnf </span><br><span class="line">rm：是否删除普通文件 &quot;custom_openssl.cnf&quot;？y</span><br></pre></td></tr></table></figure>
<p>配置Logstash server，这时在服务器中应该有了/etc/logstash/logstash.crt 证书和 /etc/logstash/logstash.key秘钥。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/logstash/conf.d/01-wazuh.conf</span><br><span class="line">把</span><br><span class="line">input &#123;</span><br><span class="line">    beats &#123;</span><br><span class="line">        port =&gt; 5000</span><br><span class="line">        codec =&gt; &quot;json_lines&quot;</span><br><span class="line">#        ssl =&gt; true</span><br><span class="line">#        ssl_certificate =&gt; &quot;/etc/logstash/logstash.crt&quot;</span><br><span class="line">#        ssl_key =&gt; &quot;/etc/logstash/logstash.key&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">改成</span><br><span class="line">input &#123;</span><br><span class="line">    beats &#123;</span><br><span class="line">        port =&gt; 5000</span><br><span class="line">        codec =&gt; &quot;json_lines&quot;</span><br><span class="line">        ssl =&gt; true</span><br><span class="line">        ssl_certificate =&gt; &quot;/etc/logstash/logstash.crt&quot;</span><br><span class="line">        ssl_key =&gt; &quot;/etc/logstash/logstash.key&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">重启logstash</span><br><span class="line">[root@localhost opt]# service logstash restart</span><br><span class="line">logstash started</span><br></pre></td></tr></table></figure>
<p>配置Filebeat</p>
<p>现在我们配置filebeat认证logstash服务器认证。<br>使用scp命令必须两台服务器都安装openssh-clients，yum -y install openssh-clients要在两台服务器上分别执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install openssh-clients</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package openssh-clients.x86_64 0:5.3p1-122.el6 will be 安装</span><br><span class="line">--&gt; 处理依赖关系 openssh = 5.3p1-122.el6，它被软件包 openssh-clients-5.3p1-122.el6.x86_64 需要</span><br><span class="line">--&gt; 处理依赖关系 libedit.so.0()(64bit)，它被软件包 openssh-clients-5.3p1-122.el6.x86_64 需要</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package libedit.x86_64 0:2.11-4.20080712cvs.1.el6 will be 安装</span><br><span class="line">---&gt; Package openssh.x86_64 0:5.3p1-111.el6 will be 升级</span><br><span class="line">--&gt; 处理依赖关系 openssh = 5.3p1-111.el6，它被软件包 openssh-server-5.3p1-111.el6.x86_64 需要</span><br><span class="line">---&gt; Package openssh.x86_64 0:5.3p1-122.el6 will be an update</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package openssh-server.x86_64 0:5.3p1-111.el6 will be 升级</span><br><span class="line">---&gt; Package openssh-server.x86_64 0:5.3p1-122.el6 will be an update</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> 软件包                               架构                        版本                                          仓库                       大小</span><br><span class="line">================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> openssh-clients                      x86_64                      5.3p1-122.el6                                 base                      443 k</span><br><span class="line">为依赖而安装:</span><br><span class="line"> libedit                              x86_64                      2.11-4.20080712cvs.1.el6                      base                       74 k</span><br><span class="line">为依赖而更新:</span><br><span class="line"> openssh                              x86_64                      5.3p1-122.el6                                 base                      277 k</span><br><span class="line"> openssh-server                       x86_64                      5.3p1-122.el6                                 base                      329 k</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install       2 Package(s)</span><br><span class="line">Upgrade       2 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：1.1 M</span><br><span class="line">下载软件包：</span><br><span class="line">(1/4): libedit-2.11-4.20080712cvs.1.el6.x86_64.rpm                                                                       |  74 kB     00:00     </span><br><span class="line">(2/4): openssh-5.3p1-122.el6.x86_64.rpm                                                                                  | 277 kB     00:00     </span><br><span class="line">(3/4): openssh-clients-5.3p1-122.el6.x86_64.rpm                                                                          | 443 kB     00:00     </span><br><span class="line">(4/4): openssh-server-5.3p1-122.el6.x86_64.rpm                                                                           | 329 kB     00:00     </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">总计                                                                                                            414 kB/s | 1.1 MB     00:02     </span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在升级   : openssh-5.3p1-122.el6.x86_64                                                                                                 1/6 </span><br><span class="line">  正在安装   : libedit-2.11-4.20080712cvs.1.el6.x86_64                                                                                      2/6 </span><br><span class="line">  正在安装   : openssh-clients-5.3p1-122.el6.x86_64                                                                                         3/6 </span><br><span class="line">  正在升级   : openssh-server-5.3p1-122.el6.x86_64                                                                                          4/6 </span><br><span class="line">  清理       : openssh-server-5.3p1-111.el6.x86_64                                                                                          5/6 </span><br><span class="line">  清理       : openssh-5.3p1-111.el6.x86_64                                                                                                 6/6 </span><br><span class="line">  Verifying  : openssh-server-5.3p1-122.el6.x86_64                                                                                          1/6 </span><br><span class="line">  Verifying  : libedit-2.11-4.20080712cvs.1.el6.x86_64                                                                                      2/6 </span><br><span class="line">  Verifying  : openssh-5.3p1-122.el6.x86_64                                                                                                 3/6 </span><br><span class="line">  Verifying  : openssh-clients-5.3p1-122.el6.x86_64                                                                                         4/6 </span><br><span class="line">  Verifying  : openssh-5.3p1-111.el6.x86_64                                                                                                 5/6 </span><br><span class="line">  Verifying  : openssh-server-5.3p1-111.el6.x86_64                                                                                          6/6 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  openssh-clients.x86_64 0:5.3p1-122.el6                                                                                                        </span><br><span class="line"></span><br><span class="line">作为依赖被安装:</span><br><span class="line">  libedit.x86_64 0:2.11-4.20080712cvs.1.el6                                                                                                     </span><br><span class="line"></span><br><span class="line">作为依赖被升级:</span><br><span class="line">  openssh.x86_64 0:5.3p1-122.el6                                      openssh-server.x86_64 0:5.3p1-122.el6                                     </span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>
<p>以下内容在filebeat服务端，也就是wazuh server上执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# scp root@192.168.106.43:/etc/logstash/logstash.crt /etc/filebeat</span><br><span class="line">root@192.168.106.43&apos;s password: </span><br><span class="line">logstash.crt</span><br></pre></td></tr></table></figure>
<p>vi /etc/filebeat/filebeat.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">修改</span><br><span class="line">output:</span><br><span class="line"> logstash:</span><br><span class="line">   # The Logstash hosts</span><br><span class="line">   hosts: [&quot;192.168.106.43:5000&quot;]</span><br><span class="line">#   ssl:</span><br><span class="line">#     certificate_authorities: [&quot;/etc/filebeat/logstash.crt&quot;]</span><br><span class="line"></span><br><span class="line">变成</span><br><span class="line">output:</span><br><span class="line"> logstash:</span><br><span class="line">   hosts: [&quot;192.168.106.43:5000&quot;]</span><br><span class="line">   ssl:</span><br><span class="line">     certificate_authorities: [&quot;/etc/filebeat/logstash.crt&quot;]</span><br></pre></td></tr></table></figure></p>
<p>重新启动filebeat</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service filebeat restart</span><br><span class="line">2017/08/23 03:36:41.485699 beat.go:285: INFO Home path: [/usr/share/filebeat] Config path: [/etc/filebeat] Data path: [/var/lib/filebeat] Logs path: [/var/log/filebeat]</span><br><span class="line">2017/08/23 03:36:41.485822 beat.go:186: INFO Setup Beat: filebeat; Version: 5.5.1</span><br><span class="line">2017/08/23 03:36:41.485956 metrics.go:23: INFO Metrics logging every 30s</span><br><span class="line">2017/08/23 03:36:41.488062 logstash.go:90: INFO Max Retries set to: 3</span><br><span class="line">2017/08/23 03:36:41.488281 outputs.go:108: INFO Activated logstash as output plugin.</span><br><span class="line">2017/08/23 03:36:41.489904 publish.go:295: INFO Publisher name: localhost.localdomain</span><br><span class="line">2017/08/23 03:36:41.508442 async.go:63: INFO Flush Interval set to: 1s</span><br><span class="line">2017/08/23 03:36:41.508504 async.go:64: INFO Max Bulk Size set to: 2048</span><br><span class="line">Config OK</span><br><span class="line">Stopping filebeat:                                         [确定]</span><br><span class="line">Starting filebeat: 2017/08/23 03:36:41.654868 beat.go:285: INFO Home path: [/usr/share/filebeat] Config path: [/etc/filebeat] Data path: [/var/lib/filebeat] Logs path: [/var/log/filebeat]</span><br><span class="line">2017/08/23 03:36:41.654971 beat.go:186: INFO Setup Beat: filebeat; Version: 5.5.1</span><br><span class="line">2017/08/23 03:36:41.655207 metrics.go:23: INFO Metrics logging every 30s</span><br><span class="line">2017/08/23 03:36:41.656127 logstash.go:90: INFO Max Retries set to: 3</span><br><span class="line">2017/08/23 03:36:41.656311 outputs.go:108: INFO Activated logstash as output plugin.</span><br><span class="line">2017/08/23 03:36:41.656522 publish.go:295: INFO Publisher name: localhost.localdomain</span><br><span class="line">2017/08/23 03:36:41.657083 async.go:63: INFO Flush Interval set to: 1s</span><br><span class="line">2017/08/23 03:36:41.657125 async.go:64: INFO Max Bulk Size set to: 2048</span><br><span class="line">Config OK</span><br><span class="line">                                                           [确定]</span><br></pre></td></tr></table></figure>
<h3 id="安装Kibana"><a href="#安装Kibana" class="headerlink" title="安装Kibana"></a>安装Kibana</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# yum install kibana</span><br><span class="line">已加载插件：fastestmirror</span><br><span class="line">设置安装进程</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirror.bit.edu.cn</span><br><span class="line"> * extras: mirror.bit.edu.cn</span><br><span class="line"> * updates: mirror.bit.edu.cn</span><br><span class="line">解决依赖关系</span><br><span class="line">--&gt; 执行事务检查</span><br><span class="line">---&gt; Package kibana.x86_64 0:5.5.2-1 will be 安装</span><br><span class="line">--&gt; 完成依赖关系计算</span><br><span class="line"></span><br><span class="line">依赖关系解决</span><br><span class="line"></span><br><span class="line">================================================================================================================================================</span><br><span class="line"> 软件包                          架构                            版本                                仓库                                  大小</span><br><span class="line">================================================================================================================================================</span><br><span class="line">正在安装:</span><br><span class="line"> kibana                          x86_64                          5.5.2-1                             elastic-5.x                           50 M</span><br><span class="line"></span><br><span class="line">事务概要</span><br><span class="line">================================================================================================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">总下载量：50 M</span><br><span class="line">Installed size: 191 M</span><br><span class="line">确定吗？[y/N]：y</span><br><span class="line">下载软件包：</span><br><span class="line">kibana-5.5.2-x86_64.rpm                                                                                                  |  50 MB     16:47     </span><br><span class="line">运行 rpm_check_debug </span><br><span class="line">执行事务测试</span><br><span class="line">事务测试成功</span><br><span class="line">执行事务</span><br><span class="line">  正在安装   : kibana-5.5.2-1.x86_64                                                                                                        1/1 </span><br><span class="line">  Verifying  : kibana-5.5.2-1.x86_64                                                                                                        1/1 </span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  kibana.x86_64 0:5.5.2-1                                                                                                                       </span><br><span class="line"></span><br><span class="line">完毕！</span><br><span class="line">[root@localhost opt]# /usr/share/kibana/bin/kibana-plugin install https://packages.wazuh.com/wazuhapp/wazuhapp.zip</span><br><span class="line">Attempting to transfer from https://packages.wazuh.com/wazuhapp/wazuhapp.zip</span><br><span class="line">Transferring 24560704 bytes....................</span><br><span class="line">Transfer complete</span><br><span class="line">Retrieving metadata from plugin archive</span><br><span class="line">Extracting plugin archive</span><br><span class="line">Extraction complete</span><br><span class="line">Optimizing and caching browser bundles...</span><br><span class="line">Plugin installation complete</span><br></pre></td></tr></table></figure>
<p>vi /etc/kibana/kibana.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">把</span><br><span class="line">#server.host: &quot;localhost&quot;</span><br><span class="line"></span><br><span class="line">改成</span><br><span class="line">server.host: &quot;0.0.0.0&quot;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>It is recommended to set up an Nginx proxy for Kibana in order to use SSL encryption and to enable authentication. Instructions to set the proxy up can be found at Setting up SSL and authentication for Kibana.<a href="https://documentation.wazuh.com/current/installation-guide/optional-configurations/kibana_ssl.html#kibana-ssl" target="_blank" rel="noopener">https://documentation.wazuh.com/current/installation-guide/optional-configurations/kibana_ssl.html#kibana-ssl</a></p>
</blockquote>
<p>重启kibana<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# chkconfig --add kibana</span><br><span class="line">[root@localhost opt]# service kibana start</span><br><span class="line">kibana started</span><br></pre></td></tr></table></figure></p>
<h3 id="通过API连接Wazuh-App"><a href="#通过API连接Wazuh-App" class="headerlink" title="通过API连接Wazuh App"></a>通过API连接Wazuh App</h3><p>通过192.168.106.43:5601访问 Kibana，无法访问，查看本地端口已经监听在0.0.0.0:5601，所以关闭防火墙。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost opt]# netstat -ntlp</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name   </span><br><span class="line">tcp        0      0 0.0.0.0:5601                0.0.0.0:*                   LISTEN      27473/node          </span><br><span class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      27360/sshd          </span><br><span class="line">tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      5748/master         </span><br><span class="line">tcp        0      0 ::ffff:127.0.0.1:9200       :::*                        LISTEN      26585/java          </span><br><span class="line">tcp        0      0 ::1:9200                    :::*                        LISTEN      26585/java          </span><br><span class="line">tcp        0      0 ::ffff:127.0.0.1:9300       :::*                        LISTEN      26585/java          </span><br><span class="line">tcp        0      0 ::1:9300                    :::*                        LISTEN      26585/java          </span><br><span class="line">tcp        0      0 :::22                       :::*                        LISTEN      27360/sshd          </span><br><span class="line">tcp        0      0 ::1:25                      :::*                        LISTEN      5748/master         </span><br><span class="line">[root@localhost opt]# iptables -L</span><br><span class="line">Chain INPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED </span><br><span class="line">ACCEPT     icmp --  anywhere             anywhere            </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:ssh </span><br><span class="line">REJECT     all  --  anywhere             anywhere            reject-with icmp-host-prohibited </span><br><span class="line"></span><br><span class="line">Chain FORWARD (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">REJECT     all  --  anywhere             anywhere            reject-with icmp-host-prohibited </span><br><span class="line"></span><br><span class="line">Chain OUTPUT (policy ACCEPT)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">[root@localhost opt]# service iptables stop</span><br><span class="line">iptables：将链设置为政策 ACCEPT：filter                    [确定]</span><br><span class="line">iptables：清除防火墙规则：                                 [确定]</span><br><span class="line">iptables：正在卸载模块：                                   [确定]</span><br></pre></td></tr></table></figure>
<ul>
<li><p>访问界面<br><img src="/2017/08/24/WAZUH/kibana-1.jpg" alt="kibana默认首页"></p>
</li>
<li><p>点击”Wazuh”按钮<br><img src="/2017/08/24/WAZUH/kibana-2.jpg" alt="kibana Wazuh按钮"></p>
</li>
<li><p>点击”ADD NEW API”<br><img src="/2017/08/24/WAZUH/kibana-3.jpg" alt="kibana add new api"></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the Wazuh App for Kibana 5</span><br><span class="line">The Wazuh App brings together a new and useful web interface for managing and monitoring your Wazuh infrastructure. You can check agent status, alert evolution, most recent events, popular alerts, top alert groups, etc. You can also display configuration and logs of the manager.</span><br><span class="line"></span><br><span class="line">In addition, make use of any or all of these extensions:</span><br><span class="line"></span><br><span class="line">Linux Audit system integration.</span><br><span class="line">PCI DSS Compliance.</span><br><span class="line">OpenSCAP security compliance and vulnerability assessments.</span><br><span class="line">The app joins Wazuh features like: Log management and analysis, file integrity monitoring, intrusion and anomaly detection and policy and compliance monitoring.</span><br><span class="line"></span><br><span class="line">Help us to improve this app. We would appreciate your feedback. Collaborate with us on the Mailing Lists and/or the Wazuh App Github repository</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Please enter your Wazuh RESTful API credentials at the form below to begin.</span><br></pre></td></tr></table></figure>
<p>请看上面的介绍，Wazuh主要的功能特性和扩展。新版本在上方的导航将api、扩展、关于分3个页面。</p>
<ul>
<li>添加api之前准备工作</li>
</ul>
<p>在填用户名、密码、url、端口之前，要先到Wazuh server主机上，使用命令生成非默认的认证来保护Wazuh API。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /var/ossec/api/configuration/auth/</span><br><span class="line">[root@localhost auth]# ls</span><br><span class="line">htpasswd  user</span><br><span class="line">[root@localhost auth]# sudo node htpasswd -c user wazuh-api</span><br><span class="line">New password: </span><br><span class="line">Re-type new password: </span><br><span class="line">Adding password for user wazuh-api.</span><br><span class="line">[root@localhost auth]# ll</span><br><span class="line">总用量 4</span><br><span class="line">lrwxrwxrwx. 1 root root 49 8月   1 15:12 htpasswd -&gt; /var/ossec/api/node_modules/htpasswd/bin/htpasswd</span><br><span class="line">-rwxr-x---. 1 root root 48 8月  23 17:47 user</span><br><span class="line">[root@localhost auth]# service wazuh-api restart</span><br><span class="line">WAZUH-API stopped.</span><br><span class="line">WAZUH-API started.</span><br></pre></td></tr></table></figure>
<p>可以先访问一下web，看认证是否成功<br><img src="/2017/08/24/WAZUH/wazuh-api-credentials.jpg" alt="wazuh-api-credentials"></p>
<ul>
<li>填入api字段-提示错误<br><img src="/2017/08/24/WAZUH/wazuh-add-api-error.jpg" alt="wazuh-add-api-error"></li>
</ul>
<p>官方的邮件列表解释了这个bug：<br><a href="https://groups.google.com/forum/#!msg/wazuh/kBVoD-X7xX4/vpDOHjKhCQAJ" target="_blank" rel="noopener">https://groups.google.com/forum/#!msg/wazuh/kBVoD-X7xX4/vpDOHjKhCQAJ</a></p>
<ul>
<li>解决v2.0的bug</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum upgrade wazuh-manager</span><br><span class="line">yum upgrade wazuh-api</span><br></pre></td></tr></table></figure>
<p>官方列表里的讨论在版本比对时逻辑有错误等，在新版本中修复，升级就可以了。<br><img src="/2017/08/24/WAZUH/wazuh-api-add-success.jpg" alt="wazuh-api-add-success"></p>
<h2 id="安装agent"><a href="#安装agent" class="headerlink" title="安装agent"></a>安装agent</h2><p>这个就很简单了：<br><a href="https://documentation.wazuh.com/current/installation-guide/installing-wazuh-agent/index.html" target="_blank" rel="noopener">https://documentation.wazuh.com/current/installation-guide/installing-wazuh-agent/index.html</a></p>
<h2 id="注册agent"><a href="#注册agent" class="headerlink" title="注册agent"></a>注册agent</h2><h3 id="Manager的server端"><a href="#Manager的server端" class="headerlink" title="Manager的server端"></a>Manager的server端</h3><ul>
<li>ssl认证</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost db]# openssl req -x509 -batch -nodes -days 365 -newkey rsa:2048 -keyout /var/ossec/etc/sslmanager.key -out /var/ossec/etc/sslmanager.cert</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">...............................+++</span><br><span class="line">.........+++</span><br><span class="line">writing new private key to &apos;/var/ossec/etc/sslmanager.key&apos;</span><br><span class="line">-----</span><br></pre></td></tr></table></figure>
<ul>
<li>开启ossec-authd服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost db]# /var/ossec/bin/</span><br><span class="line">agent_control       ossec-analysisd     ossec-execd         ossec-luac          ossec-remoted       syscheck_update     </span><br><span class="line">clear_stats         ossec-authd         ossec-integratord   ossec-maild         ossec-reportd       update_ruleset.py   </span><br><span class="line">list_agents         ossec-control       ossec-logcollector  ossec-makelists     ossec-syscheckd     util.sh             </span><br><span class="line">manage_agents       ossec-csyslogd      ossec-logtest       ossec-monitord      rootcheck_control   verify-agent-conf   </span><br><span class="line">ossec-agentlessd    ossec-dbd           ossec-lua           ossec-regex         syscheck_control    wazuh-modulesd      </span><br><span class="line">[root@localhost db]# /var/ossec/bin/ossec-authd</span><br><span class="line">[root@localhost db]#</span><br></pre></td></tr></table></figure>
<h3 id="agent-auth客户端"><a href="#agent-auth客户端" class="headerlink" title="agent-auth客户端"></a>agent-auth客户端</h3><ul>
<li>客户端注册服务端ip</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# /var/ossec/bin/agent-auth -m 192.168.106.42</span><br><span class="line">2017/08/28 14:54:58 agent-auth: INFO: Started (pid: 6235).</span><br><span class="line">WARN: No authentication password provided.</span><br><span class="line">INFO: Connected to 192.168.106.42:1515</span><br><span class="line">INFO: Using agent name as: localhost.localdomain</span><br><span class="line">INFO: Send request to manager. Waiting for reply.</span><br><span class="line">INFO: Received response with agent key</span><br><span class="line">INFO: Valid key created. Finished.</span><br><span class="line">INFO: Connection closed.</span><br></pre></td></tr></table></figure>
<h3 id="查看是否成功"><a href="#查看是否成功" class="headerlink" title="查看是否成功"></a>查看是否成功</h3><ul>
<li>server 端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost db]# cat /var/ossec/etc/client.keys</span><br><span class="line">001 localhost.localdomain any 5e7168616c858ef0d9a8c1737359825e72c17bf3a9575ed9f696e4b30masaike</span><br><span class="line">[root@localhost db]# /var/ossec/bin/agent_control -l</span><br></pre></td></tr></table></figure>
<ul>
<li>agent 端</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /var/ossec/etc/client.keys</span><br><span class="line">001 localhost.localdomain any 5e7168616c858ef0d9a8c1737359825e72c17bf3a9575ed9f696e4b30masaike</span><br></pre></td></tr></table></figure>
<h3 id="连接到服务端Manager"><a href="#连接到服务端Manager" class="headerlink" title="连接到服务端Manager"></a>连接到服务端Manager</h3><ul>
<li>/var/ossec/etc/ossec.conf</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">把</span><br><span class="line">&lt;ossec_config&gt;</span><br><span class="line">  &lt;client&gt;</span><br><span class="line">    &lt;server-ip&gt;MANAGER_IP&lt;/server-ip&gt;</span><br><span class="line">    &lt;config-profile&gt;centos, centos6&lt;/config-profile&gt;</span><br><span class="line">    &lt;protocol&gt;udp&lt;/protocol&gt;</span><br><span class="line">  &lt;/client&gt;</span><br><span class="line">改成</span><br><span class="line">&lt;ossec_config&gt;</span><br><span class="line">  &lt;client&gt;</span><br><span class="line">    &lt;server-ip&gt;192.168.106.42&lt;/server-ip&gt;</span><br><span class="line">    &lt;config-profile&gt;centos, centos6&lt;/config-profile&gt;</span><br><span class="line">    &lt;protocol&gt;udp&lt;/protocol&gt;</span><br><span class="line">  &lt;/client&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>启动（重启）wazuh-agent</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# service wazuh-agent start</span><br><span class="line">Starting OSSEC: 2017/08/28 15:19:09 ossec-agentd: INFO: Using notify time: 600 and max time to reconnect: 1800</span><br><span class="line">                                                           [  OK  ]</span><br></pre></td></tr></table></figure>
<p>但是你会看到wazuh面板agents管理上，显示的连接过来的机器ip写的是any。因为<br>/var/ossec/bin/ossec-authd默认启动后，将注册any为连接ip，在服务端kill掉ossec-authd进程，然后<br>/var/ossec/bin/ossec-authd -i启动。在server端通过<br>/var/ossec/bin/manage_agents，删除已经注册的agent；在agent端删除<br>/var/ossec/etc/client.keys里的内容记录，重新<br>/var/ossec/bin/agent-auth -m 192.168.106.42注册，重启agent。</p>
</div><div class="tags"><a href="/tags/甲方安全/">甲方安全</a><a href="/tags/信息安全/">信息安全</a><a href="/tags/安全监控/">安全监控</a><a href="/tags/Wazuh/">Wazuh</a><a href="/tags/ELK/">ELK</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2017/08/25/qqmailxss/" class="pre">QQ邮箱反射型xss漏洞</a><a href="/2017/07/25/reverse-shell/" class="next">反弹shell监控</a></div><div id="comments"><script src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script><div id="comment"></div><script type="text/javascript">new Valine({
  el: '#comment',  
  notify: false, 
  verify: false, 
  app_id: 'LxlH8totxFLNwkT4nTy2ccay-gzGzoHsz',
  appKey: 'Pzf3CsqHnjhKJryLexrAy45U',
  // 评论框占位符
  placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',  
  // 当前文章页路径，用于区分不同的文章页，以保证正确读取该文章页下的评论列表
  path:window.location.pathname,  
  // 默认头像类型
  avatar: 'wavatar',
  // 每页展示评论条数
  pageSize: 15
});</script></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WAZUH架构图"><span class="toc-text">WAZUH架构图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分布式"><span class="toc-text">分布式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#单台部署"><span class="toc-text">单台部署</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-Wazuh-server"><span class="toc-text">Install Wazuh server</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加CentOS-wazuh源"><span class="toc-text">添加CentOS wazuh源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Wazuh-manager"><span class="toc-text">安装Wazuh-manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Wazuh-API"><span class="toc-text">安装Wazuh API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Filebeat"><span class="toc-text">安装 Filebeat</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-Elastic-Stack"><span class="toc-text">Install Elastic Stack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-Java-JRE-Logstash和Elasticsearch必要的依赖"><span class="toc-text">安装 Java JRE (Logstash和Elasticsearch必要的依赖)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装elasticsearch"><span class="toc-text">安装elasticsearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Logstash"><span class="toc-text">安装Logstash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setting-up-SSL-for-Filebeat-and-Logstash"><span class="toc-text">Setting up SSL for Filebeat and Logstash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Kibana"><span class="toc-text">安装Kibana</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过API连接Wazuh-App"><span class="toc-text">通过API连接Wazuh App</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装agent"><span class="toc-text">安装agent</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注册agent"><span class="toc-text">注册agent</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Manager的server端"><span class="toc-text">Manager的server端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#agent-auth客户端"><span class="toc-text">agent-auth客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查看是否成功"><span class="toc-text">查看是否成功</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#连接到服务端Manager"><span class="toc-text">连接到服务端Manager</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/12/14/bacscanner/">越权扫描器碎碎念</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/24/quant/">币圈量化交易试水</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/22/golangxml/">被动扫描器研发（1）：golang生成cdata xml格式数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/17/awvs/">awvs（12.0.190515149）linux 安装和破解</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/opencanary_2/">opencanary二次开发(1)-日志格式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/09/opencanary_1/">蜜罐正式开源-简单易用-支持16种协议</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/17/SPA/">前后端分离开发风险浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/14/异地恋/">异地恋</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/26/phishing/">甲方企业安全建设之钓鱼实践的一种姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/20/yulong-hids/">驭龙hids入侵检测功能初探</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/安全建设/">安全建设</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全开发/">安全开发</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全运维/">安全运维</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工作生活/">工作生活</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/渗透测试/">渗透测试</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/诗和远方/">诗和远方</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/量化交易/">量化交易</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Phishing/" style="font-size: 15px;">Phishing</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/运维/" style="font-size: 15px;">运维</a> <a href="/tags/审计策略/" style="font-size: 15px;">审计策略</a> <a href="/tags/安全建设/" style="font-size: 15px;">安全建设</a> <a href="/tags/甲方安全/" style="font-size: 15px;">甲方安全</a> <a href="/tags/前后端分离/" style="font-size: 15px;">前后端分离</a> <a href="/tags/开发/" style="font-size: 15px;">开发</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/渗透测试/" style="font-size: 15px;">渗透测试</a> <a href="/tags/文件上传漏洞/" style="font-size: 15px;">文件上传漏洞</a> <a href="/tags/阿里云OSS/" style="font-size: 15px;">阿里云OSS</a> <a href="/tags/awvs/" style="font-size: 15px;">awvs</a> <a href="/tags/漏洞扫描器/" style="font-size: 15px;">漏洞扫描器</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/回调函数/" style="font-size: 15px;">回调函数</a> <a href="/tags/脏牛/" style="font-size: 15px;">脏牛</a> <a href="/tags/dirtycow/" style="font-size: 15px;">dirtycow</a> <a href="/tags/CVE-2016-5195/" style="font-size: 15px;">CVE-2016-5195</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/留言板/" style="font-size: 15px;">留言板</a> <a href="/tags/CVE-2017-7525/" style="font-size: 15px;">CVE-2017-7525</a> <a href="/tags/CVE-2017-17485/" style="font-size: 15px;">CVE-2017-17485</a> <a href="/tags/Jackson-databind反序列化漏洞/" style="font-size: 15px;">Jackson-databind反序列化漏洞</a> <a href="/tags/安全分析/" style="font-size: 15px;">安全分析</a> <a href="/tags/蜜罐/" style="font-size: 15px;">蜜罐</a> <a href="/tags/开源/" style="font-size: 15px;">开源</a> <a href="/tags/opencanary/" style="font-size: 15px;">opencanary</a> <a href="/tags/OSS对象存储/" style="font-size: 15px;">OSS对象存储</a> <a href="/tags/上传漏洞/" style="font-size: 15px;">上传漏洞</a> <a href="/tags/解析漏洞/" style="font-size: 15px;">解析漏洞</a> <a href="/tags/漏洞预警/" style="font-size: 15px;">漏洞预警</a> <a href="/tags/截屏/" style="font-size: 15px;">截屏</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/信息安全/" style="font-size: 15px;">信息安全</a> <a href="/tags/黑客/" style="font-size: 15px;">黑客</a> <a href="/tags/信息收集/" style="font-size: 15px;">信息收集</a> <a href="/tags/系统/" style="font-size: 15px;">系统</a> <a href="/tags/钓鱼/" style="font-size: 15px;">钓鱼</a> <a href="/tags/poster模块/" style="font-size: 15px;">poster模块</a> <a href="/tags/上传/" style="font-size: 15px;">上传</a> <a href="/tags/xss/" style="font-size: 15px;">xss</a> <a href="/tags/QQ邮箱/" style="font-size: 15px;">QQ邮箱</a> <a href="/tags/ssrf/" style="font-size: 15px;">ssrf</a> <a href="/tags/w3af/" style="font-size: 15px;">w3af</a> <a href="/tags/诗歌/" style="font-size: 15px;">诗歌</a> <a href="/tags/配置文件/" style="font-size: 15px;">配置文件</a> <a href="/tags/xml/" style="font-size: 15px;">xml</a> <a href="/tags/cdata/" style="font-size: 15px;">cdata</a> <a href="/tags/burpsuite/" style="font-size: 15px;">burpsuite</a> <a href="/tags/golang/" style="font-size: 15px;">golang</a> <a href="/tags/二次开发/" style="font-size: 15px;">二次开发</a> <a href="/tags/btc/" style="font-size: 15px;">btc</a> <a href="/tags/量化交易/" style="font-size: 15px;">量化交易</a> <a href="/tags/CVE-2017-10271/" style="font-size: 15px;">CVE-2017-10271</a> <a href="/tags/java反序列化/" style="font-size: 15px;">java反序列化</a> <a href="/tags/weblogic反序列化漏洞/" style="font-size: 15px;">weblogic反序列化漏洞</a> <a href="/tags/XMLDecoder反序列化漏洞/" style="font-size: 15px;">XMLDecoder反序列化漏洞</a> <a href="/tags/工作生活/" style="font-size: 15px;">工作生活</a> <a href="/tags/乙方安全/" style="font-size: 15px;">乙方安全</a> <a href="/tags/启动流程/" style="font-size: 15px;">启动流程</a> <a href="/tags/账户管理/" style="font-size: 15px;">账户管理</a> <a href="/tags/tornado/" style="font-size: 15px;">tornado</a> <a href="/tags/Web自动化攻击平台/" style="font-size: 15px;">Web自动化攻击平台</a> <a href="/tags/Apache-Commons-Collections/" style="font-size: 15px;">Apache Commons Collections</a> <a href="/tags/反弹shell/" style="font-size: 15px;">反弹shell</a> <a href="/tags/安全监控/" style="font-size: 15px;">安全监控</a> <a href="/tags/exp/" style="font-size: 15px;">exp</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/网络安全/" style="font-size: 15px;">网络安全</a> <a href="/tags/hids/" style="font-size: 15px;">hids</a> <a href="/tags/驭龙hids/" style="font-size: 15px;">驭龙hids</a> <a href="/tags/安全开发/" style="font-size: 15px;">安全开发</a> <a href="/tags/Wazuh/" style="font-size: 15px;">Wazuh</a> <a href="/tags/ELK/" style="font-size: 15px;">ELK</a> <a href="/tags/越权/" style="font-size: 15px;">越权</a> <a href="/tags/扫描器/" style="font-size: 15px;">扫描器</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.0x001.com/" title="0x001" target="_blank">0x001</a><ul></ul><a href="http://ksowo.com/" title="lyy" target="_blank">lyy</a><ul></ul><a href="http://xxlegend.com/" title="xxlegend" target="_blank">xxlegend</a><ul></ul><a href="https://bl4ck.in/" title="Tomato" target="_blank">Tomato</a><ul></ul><a href="https://my.oschina.net/9199771" title="超级大黑猫" target="_blank">超级大黑猫</a><ul></ul><a href="https://www.weiho.xyz/" title="Weiho" target="_blank">Weiho</a><ul></ul><a href="https://www.maliciouskr.cc/" title="MaliciousKr" target="_blank">MaliciousKr</a><ul></ul><a href="http://www.lshack.cn/" title="lsh4ck's blog" target="_blank">lsh4ck's blog</a><ul></ul><a href="https://www.0x002.com" title="Yunen's blog" target="_blank">Yunen's blog</a><ul></ul><a href="https://www.dp2px.com/" title="水寒的博客" target="_blank">水寒的博客</a><ul></ul><a href="https://www.pa55w0rd.online/" title="Pa55w0rd's blog" target="_blank">Pa55w0rd's blog</a><ul></ul><a href="http://www.mianhuage.com/" title="Cotton's Blog" target="_blank">Cotton's Blog</a><ul></ul><a href="https://zgao.top/" title="zgao" target="_blank">zgao</a><ul></ul><a href="http://lab.orchina.org/" title="糖果的实验室" target="_blank">糖果的实验室</a><ul></ul><a href="https://www.ms17010.net/" title="yd" target="_blank">yd</a><ul></ul><a href="http://blog.leanote.com/snowming" title="snowming" target="_blank">snowming</a><ul></ul><a href="https://www.cnblogs.com/ssooking" title="ssooking" target="_blank">ssooking</a><br>
<br>
『将定期清理无法访问的友情链接』</div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Sitemap</a> |  <a href="/sitemap.xml">Google Sitemap</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">pirogue.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-92976027-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>